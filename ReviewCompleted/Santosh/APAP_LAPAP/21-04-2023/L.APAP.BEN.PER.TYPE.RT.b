$PACKAGE APAP.LAPAP
SUBROUTINE L.APAP.BEN.PER.TYPE.RT(Y.BENEFICIARY,OUT.ARR2)
*--------------------------------------------------------------------------------------------------------
* Date              Author                    Description
* ==========        ====================      ============
* 2018-04-02        APAP                CN008525 --> COMMON ROUTINE TO GET BENEFICIARY PERSON TYPE
* Date                  who                   Reference              
* 21-04-2023         CONVERSTION TOOL      R22 AUTO CONVERSTION -$INSERT T24.BP TO $INSERT AND FM TO @FM AND VM TO @VM AND F.READ TO CACHE.READ AND REMOVED F.BENEFICIARY
* 21-04-2023          ANIL KUMAR B         R22 MANUAL CONVERSTION -NO CHANGES

*--------------------------------------------------------------------------------------------------------
    $INSERT I_COMMON
    $INSERT I_EQUATE
    $INSERT I_F.BENEFICIARY
    GOSUB INITIAL
    GOSUB GET.VALUES
    GOSUB GET.SET.IDENTITY
    GOSUB GET.CUST.TYPE
    OUT.ARR2 = CUST.TYPE:@FM:PERSON.IDENT
RETURN
INITIAL:
    Y.APPLICATION = 'BENEFICIARY'
    Y.FIELDS = 'L.BEN.DOC.ARCIB':@VM:'L.BEN.CEDULA':@VM:'L.BEN.COUNTRY':@VM:'L.BEN.GENDER'
    CALL MULTI.GET.LOC.REF(Y.APPLICATION,Y.FIELDS,Y.FIELD.POS)
    L.BEN.DOC.ARCIB.POS = Y.FIELD.POS<1,1>
    L.BEN.CEDULA.POS = Y.FIELD.POS<1,2>
    L.BEN.COUNTRY.POS = Y.FIELD.POS<1,3>
    L.BEN.GENDER.POS = Y.FIELD.POS<1,4>
*----------------------------------
    FN.BENEFICIARY = 'F.BENEFICIARY'; F.BENEFICIARY = ''
    CALL OPF(FN.BENEFICIARY,F.BENEFICIARY)
    HIS.REC = ''
    YERROR = ''
    FN.BENEFICIARY.HIS = 'F.BENEFICIARY$HIS' ; F.BENEFICIARY.HIS = ''
    CALL OPF(FN.BENEFICIARY.HIS,F.BENEFICIARY.HIS)
RETURN
GET.VALUES:
    R.BENEFICIARY = ''; ERR.BENEFICIARY = ''
    CALL CACHE.READ(FN.BENEFICIARY, Y.BENEFICIARY, R.BENEFICIARY, ERR.BENEFICIARY)  ;*R22 AUTO CONVERSTION F.READ TO CACHE.READ AND REMOVED F.BENEFICIARY
    IF R.BENEFICIARY EQ '' THEN
        Y.REC.ID = Y.BENEFICIARY
        CALL EB.READ.HISTORY.REC(F.BENEFICIARY.HIS,Y.REC.ID,HIST.REC,YERROR)
        R.BENEFICIARY = HIST.REC
    END
RETURN
GET.SET.IDENTITY:
    Y.L.BEN.DOC.ARCIB = R.BENEFICIARY<ARC.BEN.LOCAL.REF,L.BEN.DOC.ARCIB.POS>
    Y.L.BEN.CEDULA = R.BENEFICIARY<ARC.BEN.LOCAL.REF,L.BEN.CEDULA.POS>
    Y.L.BEN.GENERO = R.BENEFICIARY<ARC.BEN.LOCAL.REF,L.BEN.GENDER.POS>          ;*'MALE'
    Y.L.BEN.NACIONALIDAD = R.BENEFICIARY<ARC.BEN.LOCAL.REF,L.BEN.COUNTRY.POS>   ;*'DO'
    PERSON.IDENT = ''
    P.TYPE = 'ND'
    BEGIN CASE
        CASE (Y.L.BEN.DOC.ARCIB EQ 'Cedula' OR Y.L.BEN.DOC.ARCIB EQ 'CEDULA')
            Y.L.BEN.NACIONALIDAD = 'DO'
            STR.VALUE.1 = '-'
            SRT.VALUE.2 = ''
            MOD.PERSON.IDENT = CHANGE(Y.L.BEN.CEDULA,STR.VALUE.1,SRT.VALUE.2)
            PERSON.IDENT = MOD.PERSON.IDENT
            IF LEN(PERSON.IDENT) EQ 11 THEN
                PERSON.IDENT = PERSON.IDENT[1,3] : '-' : PERSON.IDENT[4,7] : '-' : PERSON.IDENT[11,1]
            END
            P.TYPE = 'PERSONA FISICA'
        CASE (Y.L.BEN.DOC.ARCIB EQ 'RNC')
            PERSON.IDENT = Y.L.BEN.CEDULA
            IF LEN(PERSON.IDENT) EQ 9 THEN
                PERSON.IDENT = PERSON.IDENT[1,1] : '-' : PERSON.IDENT[2,2] : '-' : PERSON.IDENT[4,5] :'-': PERSON.IDENT[9,1]
            END
            P.TYPE = 'PERSONA JURIDICA'
        CASE (Y.L.BEN.DOC.ARCIB EQ 'Pasaporte' OR Y.L.BEN.DOC.ARCIB EQ 'PASAPORTE')
            MOD.PERSON.IDENT = Y.L.BEN.NACIONALIDAD : Y.L.BEN.CEDULA
            PERSON.IDENT = MOD.PERSON.IDENT
            P.TYPE = 'PERSONA FISICA'
        CASE (Y.L.BEN.DOC.ARCIB EQ 'No.Unico' OR Y.L.BEN.DOC.ARCIB EQ 'NO.UNICO' OR Y.L.BEN.DOC.ARCIB EQ 'Acta de Nacimiento')
            PERSON.IDENT = Y.L.BEN.CEDULA
            P.TYPE = 'CLIENTE MENOR'
    END CASE
RETURN
GET.CUST.TYPE:
**************

    BEGIN CASE
        CASE Y.L.BEN.NACIONALIDAD EQ 'DO' AND (Y.L.BEN.GENERO EQ 'MALE' OR Y.L.BEN.GENERO EQ 'MASCULINO') AND (P.TYPE EQ 'PERSONA FISICA' OR P.TYPE EQ 'CLIENTE MENOR')
            CUST.TYPE = 'P3'
        CASE Y.L.BEN.NACIONALIDAD NE 'DO' AND (Y.L.BEN.GENERO EQ 'MALE' OR Y.L.BEN.GENERO EQ 'MASCULINO') AND ((P.TYPE EQ 'PERSONA FISICA' AND PERSON.IDENT NE '') OR P.TYPE EQ 'CLIENTE MENOR')
            CUST.TYPE = 'P4'
        CASE Y.L.BEN.NACIONALIDAD EQ 'DO' AND (Y.L.BEN.GENERO EQ 'FEMALE' OR Y.L.BEN.GENERO EQ 'FEMENINO') AND (P.TYPE EQ 'PERSONA FISICA' OR P.TYPE EQ 'CLIENTE MENOR')
            CUST.TYPE = 'P5'
        CASE Y.L.BEN.NACIONALIDAD NE 'DO' AND (Y.L.BEN.GENERO EQ 'FEMALE' OR Y.L.BEN.GENERO EQ 'FEMENINO') AND ((P.TYPE EQ 'PERSONA FISICA' AND PERSON.IDENT NE '') OR P.TYPE EQ 'CLIENTE MENOR')
            CUST.TYPE = 'P6'
        CASE Y.L.BEN.NACIONALIDAD NE 'DO' AND (Y.L.BEN.GENERO EQ 'MALE' OR Y.L.BEN.GENERO EQ 'MASCULINO') AND ((P.TYPE EQ 'PERSONA FISICA') OR P.TYPE EQ 'CLIENTE MENOR')
            CUST.TYPE = 'P7'
        CASE Y.L.BEN.NACIONALIDAD NE 'DO' AND (Y.L.BEN.GENERO EQ 'FEMALE' OR Y.L.BEN.GENERO EQ 'FEMENINO') AND ((P.TYPE EQ 'PERSONA FISICA') OR P.TYPE EQ 'CLIENTE MENOR')
            CUST.TYPE = 'P8'
        CASE Y.L.BEN.NACIONALIDAD EQ 'DO' AND P.TYPE EQ 'PERSONA JURIDICA' AND PERSON.IDENT NE ''
            CUST.TYPE = 'E1'
        CASE Y.L.BEN.DOC.ARCIB EQ 'RNC' AND P.TYPE EQ 'PERSONA JURIDICA'
            CUST.TYPE = 'E1'
* CASE Y.L.BEN.NACIONALIDAD NE 'DO' AND Y.L.BEN.GENERO EQ 'MALE' AND ((P.TYPE EQ 'PERSONA FISICA' AND YCUS.FOREIGN NE '') OR P.TYPE EQ 'CLIENTE MENOR')
*       CUST.TYPE = 'P7'
*    CASE Y.L.BEN.NACIONALIDAD NE 'DO' AND Y.L.BEN.GENERO EQ 'FEMALE' AND ((P.TYPE EQ 'PERSONA FISICA' AND YCUS.FOREIGN NE '') OR P.TYPE EQ 'CLIENTE MENOR')
*        CUST.TYPE = 'P8'
*    CASE Y.L.BEN.NACIONALIDAD NE 'DO' AND P.TYPE EQ 'PERSONA JURIDICA' AND (CUS.INDUST LT '651000' AND CUS.INDUST NE '')
*        CUST.TYPE = 'E2'
*    CASE Y.L.BEN.NACIONALIDAD NE 'DO' AND P.TYPE EQ 'PERSONA JURIDICA' AND CUS.INDUST GT '659990'
*        CUST.TYPE = 'E2'
*    CASE Y.L.BEN.NACIONALIDAD NE 'DO' AND P.TYPE EQ 'PERSONA JURIDICA' AND (CUS.INDUST GE '651000' AND CUS.INDUST LE '659990')
*        CUST.TYPE = 'E3'
    END CASE
RETURN
END
