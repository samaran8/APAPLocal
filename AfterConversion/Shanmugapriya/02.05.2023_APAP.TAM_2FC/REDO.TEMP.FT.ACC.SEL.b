* @ValidationCode : MjotMjExMTczMjkxOkNwMTI1MjoxNjgzMDE4MDk2NjA3OklUU1M6LTE6LTE6MDoxOmZhbHNlOk4vQTpSMjFfQU1SLjA6LTE6LTE=
* @ValidationInfo : Timestamp         : 02 May 2023 14:31:36
* @ValidationInfo : Encoding          : Cp1252
* @ValidationInfo : User Name         : ITSS
* @ValidationInfo : Nb tests success  : N/A
* @ValidationInfo : Nb tests failure  : N/A
* @ValidationInfo : Rating            : N/A
* @ValidationInfo : Coverage          : N/A
* @ValidationInfo : Strict flag       : true
* @ValidationInfo : Bypass GateKeeper : false
* @ValidationInfo : Compiler Version  : R21_AMR.0
* @ValidationInfo : Copyright Temenos Headquarters SA 1993-2021. All rights reserved.
$PACKAGE APAP.TAM

SUBROUTINE REDO.TEMP.FT.ACC.SEL
*-----------------------------------------------------------------------------
*DESCRIPTION:
*------------
*This routine is ID routine attached to TELLER, CUSTOMER, ACCOUNT, FUNDS.TRANSFER,
*USER and TELLER.ID version to prevent transaction input if status is closed
*
* Input/Output:
*--------------
* IN : -NA-
* OUT : -NA-
*
* Dependencies:
*---------------
* CALLS : @ID
* CALLED BY :
*
* Revision History:
*------------------------------------------------------------------------------------------
* Date who Reference Description
* 20-12-2010 JEEVAT N.45 Initial creation
* 21-07-2011 Bharath G PACS00085750 FT.DEBIT.THEIR.REF removed from version
* 23-07-2011 Bharath G PACS00085750 Code Review issue to remove F.READ and to use CACHE.READ
* 09-09-2011 Marimuthu S PACS00121111
* 13-JUL-2012 MARIMUTHU S PACS00203617
* 02-AUG-2012 Nandhini M PACS00210703
* 08/03/2013 Vignesh Kumaar M R PACS00251027 To update the credit account number
*Modification History:
*DATE                 WHO                  REFERENCE                     DESCRIPTION
*17/04/2023      CONVERSION TOOL     AUTO R22 CODE CONVERSION             NOCHANGE
*17/04/2023         SURESH           MANUAL R22 CODE CONVERSION         CALL Rtn format modified
*------------------------------------------------------------------------------------------

    $INSERT I_COMMON
    $INSERT I_EQUATE
    $INSERT I_F.TELLER
    $INSERT I_F.REDO.FT.TT.TRANSACTION
    $INSERT I_F.ACCOUNT
    $INSERT I_F.MULTI.BRANCH.INTERNAL.ACCOUNT
    $INSERT I_F.REDO.BRANCH.INT.ACCT.PARAM
*   $INSERT I_F.ACCOUNT ;*AUTO R22 CODE CONVERSION

    GOSUB INIT
    GOSUB OPEN.FILES
    GOSUB PROCESS
RETURN

*----*
INIT:
*----*
*-----------*
*Initialising
*-----------*
    REC.ID='SYSTEM'
RETURN

*---------*
OPEN.FILES:
*---------*
*------------*
*Opening files
*------------*

    FN.MULTI.BRANCH.INTERNAL.ACCOUNT ='F.MULTI.BRANCH.INTERNAL.ACCOUNT'
    FN.ACCOUNT = 'F.ACCOUNT'
    F.ACCOUNT = ''
    F.MULTI.BRANCH.INTERNAL.ACCOUNT = ''

    CALL OPF(FN.MULTI.BRANCH.INTERNAL.ACCOUNT,F.MULTI.BRANCH.INTERNAL.ACCOUNT)
    CALL OPF(FN.ACCOUNT,F.ACCOUNT)

    FN.REDO.BRANCH.INT.ACCT.PARAM = 'F.REDO.BRANCH.INT.ACCT.PARAM'
    F.REDO.BRANCH.INT.ACCT.PARAM = ''
    R.REDO.BRANCH.INT.ACCT.PARAM = ''
    CALL OPF(FN.REDO.BRANCH.INT.ACCT.PARAM,F.REDO.BRANCH.INT.ACCT.PARAM)

    FN.ACCOUNT = 'F.ACCOUNT'
    F.ACCOUNT = ''
    CALL OPF(FN.ACCOUNT,F.ACCOUNT)

RETURN

*-------*
PROCESS:
*-------*

*-----------------------------------------------------*
*Raising Error Message if the operation Status is Closes
*-----------------------------------------------------*
* PACS00085750 - S
* CALL F.READ(FN.MULTI.BRANCH.INTERNAL.ACCOUNT,REC.ID,R.MULTI.BRANCH.INTERNAL.ACCOUNT,F.MULTI.BRANCH.INTERNAL.ACCOUNT,Y.ERR)
    CALL CACHE.READ(FN.MULTI.BRANCH.INTERNAL.ACCOUNT,REC.ID,R.MULTI.BRANCH.INTERNAL.ACCOUNT,Y.ERR)
* PACS00085750 - E

    VAR.VERSION.NAME = R.MULTI.BRANCH.INTERNAL.ACCOUNT<REDO.BR.ACCT.VERSION>
    Y.TEMP.VERSION.NAME = APPLICATION:PGM.VERSION
    Y.APPLICATION  = 'REDO.FT.TT.TRANSACTION'
    Y.VERSION.NAME = Y.APPLICATION:PGM.VERSION

    LOCATE Y.VERSION.NAME IN VAR.VERSION.NAME<1,1> SETTING POS THEN
        R.NEW(FT.TN.CREDIT.ACCT.NO) = R.MULTI.BRANCH.INTERNAL.ACCOUNT<REDO.BR.ACCT.ACCOUNT,POS>
        Y.CRD.ID = R.MULTI.BRANCH.INTERNAL.ACCOUNT<REDO.BR.ACCT.ACCOUNT,POS>
        CALL F.READ(FN.ACCOUNT,Y.CRD.ID,R.ACCOUNT,F.ACCOUNT,ACC.ERR)
        R.NEW(FT.TN.CREDIT.CURRENCY) = R.ACCOUNT<AC.CURRENCY>
    END

* PACS00085750 - S
    IF Y.TEMP.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.CASH' OR Y.TEMP.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,CHQ.OTHERS.LOAN.DUM' OR Y.TEMP.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.OTI' OR Y.TEMP.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,CHQ.OTHERS.LOAN' THEN
        Y.ACC.ID = COMI
        IF Y.ACC.ID EQ '' THEN
            Y.ACC.ID = R.NEW(FT.TN.DEBIT.ACCT.NO)
        END
        CALL F.READ(FN.ACCOUNT,Y.ACC.ID,R.ACCOUNT,F.ACCOUNT,Y.ERR)
        R.NEW(FT.TN.FT.CLIENT.COD) = R.ACCOUNT<AC.CUSTOMER>
    END
* PACS00085750 - E
**PACS00210703

    CALL CACHE.READ(FN.REDO.BRANCH.INT.ACCT.PARAM,REC.ID,R.REDO.BRANCH.INT.ACCT.PARAM,E.REDO.BRANCH.INT.ACCT.PARAM)
    Y.APPLICATION  = 'FUNDS.TRANSFER'
    Y.VERSION.NAME = Y.APPLICATION:PGM.VERSION
    GET.VERSION.ARR = R.REDO.BRANCH.INT.ACCT.PARAM<BR.INT.ACCT.VERSION.NAME>

    LOCATE Y.VERSION.NAME IN GET.VERSION.ARR<1,1> SETTING ACC.POS THEN
        Y.CRD.ID = R.REDO.BRANCH.INT.ACCT.PARAM<BR.INT.ACCT.INT.ACCOUNT,ACC.POS>
        R.NEW(FT.TN.CREDIT.ACCT.NO) = Y.CRD.ID
        CALL F.READ(FN.ACCOUNT,Y.CRD.ID,R.ACCOUNT,F.ACCOUNT,ACC.ERR)
        R.NEW(FT.TN.CREDIT.CURRENCY) = R.ACCOUNT<AC.CURRENCY>
    END

* End of Fix

***PACS00210703
* PACS00085750 - S
    Y.ARR.ID = COMI
    IF Y.ARR.ID EQ '' THEN
        Y.ARR.ID = R.NEW(FT.TN.DEBIT.ACCT.NO)
    END
    IF Y.ARR.ID[1,2] EQ 'AA' THEN
        IN.ACC.ID = Y.ARR.ID
        IN.ARR.ID = ''
        OUT.ID = ''
        ERR.TEXT = ''
*CALL REDO.CONVERT.ACCOUNT(IN.ACC.ID,IN.ARR.ID,OUT.ID,ERR.TEXT)
        CALL APAP.TAM.redoConvertAccount(IN.ACC.ID,IN.ARR.ID,OUT.ID,ERR.TEXT) ;*MANUAL R22 CODE CONVERSION
        Y.ARR.ID = OUT.ID
    END

    CALL F.READ(FN.ACCOUNT,Y.ARR.ID,R.ACCOUNT,F.ACCOUNT,ACCOUNT.ERR)
    R.NEW(FT.TN.DEBIT.CURRENCY) = R.ACCOUNT<AC.CURRENCY>
    IF R.ACCOUNT<AC.ARRANGEMENT.ID> EQ '' THEN
        AF = FT.TN.DEBIT.ACCT.NO
        ETEXT = "EB-NOT.ARRANGEMENT.ID"
        CALL STORE.END.ERROR
    END
* PACS00085750 - E
    IF Y.TEMP.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.LTCC' THEN
        R.NEW(FT.TN.ORDERING.CUST) = R.ACCOUNT<AC.CUSTOMER>
    END

RETURN
END
