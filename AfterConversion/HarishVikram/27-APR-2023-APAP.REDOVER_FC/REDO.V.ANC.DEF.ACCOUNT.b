* @ValidationCode : MjotMjExMzkzNjQwODpDcDEyNTI6MTY4MjQxMjMzMjYyNjpIYXJpc2h2aWtyYW1DOi0xOi0xOjA6MTpmYWxzZTpOL0E6REVWXzIwMjEwOC4wOi0xOi0x
* @ValidationInfo : Timestamp         : 25 Apr 2023 14:15:32
* @ValidationInfo : Encoding          : Cp1252
* @ValidationInfo : User Name         : HarishvikramC
* @ValidationInfo : Nb tests success  : N/A
* @ValidationInfo : Nb tests failure  : N/A
* @ValidationInfo : Rating            : N/A
* @ValidationInfo : Coverage          : N/A
* @ValidationInfo : Strict flag       : true
* @ValidationInfo : Bypass GateKeeper : false
* @ValidationInfo : Compiler Version  : DEV_202108.0
* @ValidationInfo : Copyright Temenos Headquarters SA 1993-2021. All rights reserved.
$PACKAGE APAP.REDOVER
SUBROUTINE REDO.V.ANC.DEF.ACCOUNT
*---------------------------------------------------------------------------
* COMPANY NAME: ASOCIACION POPULAR DE AHORROS Y PRESTAMOS
* DEVELOPED BY: H GANESH
* PROGRAM NAME: REDO.V.ANC.DEF.ACCOUNT
* ODR NO      : ODR-2009-12-0285
*----------------------------------------------------------------------
*DESCRIPTION: This routine is auto new content routine attached to DEBIT.ACCT.NO field in
* FT and ACCOUNT.1 in TELLER

* FT,REVERSE.CHQ
* TELLER,CASH.CHQ
* FUNDS.TRANSFER,REINSTATE
* TELLER,REINSTATE
* FT,MGR.REVERSE.CHQ
* TELLER,MGR.CASH.CHQ




*IN PARAMETER: NA
*OUT PARAMETER: NA
*LINKED WITH: TELLER & FT
*----------------------------------------------------------------------
* Modification History :
*-----------------------
*DATE           WHO           REFERENCE         DESCRIPTION
*19.02.2010  H GANESH     ODR-2009-12-0285  INITIAL CREATION
*18-FEB-2010 KAVITHA      ODR-2009-12-0285  HD1052812  FIX
*----------------------------------------------------------------------
*Modification History
*DATE                WHO                         REFERENCE                DESCRIPTION
*06-04-2023       Conversion Tool        R22 Auto Code conversion          VM TO @VM
*06-04-2023       Samaran T               R22 Manual Code Conversion       No Changes
*-----------------------------------------------------------------------------------------


    $INSERT I_COMMON
    $INSERT I_EQUATE
    $INSERT I_F.TELLER
    $INSERT I_F.FUNDS.TRANSFER

    GOSUB INIT
    GOSUB OPENFILES
    GOSUB PROCESS
RETURN
*----------------------------------------------------------------------
INIT:
*----------------------------------------------------------------------
    FN.TELLER.HIS='F.TELLER$HIS'
    F.TELLER.HIS=''
    R.TELLER = ''

    FN.FUNDS.TRANSFER.HIS='F.FUNDS.TRANSFER$HIS'
    F.FUNDS.TRANSFER.HIS=''
    R.FUNDS.TRANSFER = ''

    FN.TELLER = 'F.TELLER'
    F.TELLER = ''
    CALL OPF(FN.TELLER,F.TELLER)

    FN.TELLER.USER = 'F.TELLER.USER'
    F.TELLER.USER = ''
    CALL OPF(FN.TELLER.USER,F.TELLER.USER)

    FN.FUNDS.TRANSFER='F.FUNDS.TRANSFER'
    F.FUNDS.TRANSFER=''
    CALL OPF(FN.FUNDS.TRANSFER,F.FUNDS.TRANSFER)

RETURN

*----------------------------------------------------------------------
OPENFILES:
*----------------------------------------------------------------------
    CALL OPF(FN.TELLER.HIS,F.TELLER.HIS)
    CALL OPF(FN.FUNDS.TRANSFER.HIS,F.FUNDS.TRANSFER.HIS)

RETURN
*----------------------------------------------------------------------
PROCESS:
*----------------------------------------------------------------------

    Y.DATA = ""
    CALL BUILD.USER.VARIABLES(Y.DATA)
    Y.HIST.ID=FIELD(Y.DATA,"*",2)

    Y.HIST.ID = FIELD(Y.HIST.ID,";",1)

    IF APPLICATION EQ 'TELLER' AND Y.HIST.ID NE '' THEN
        CALL EB.READ.HISTORY.REC(F.TELLER.HIS,Y.HIST.ID,R.TELLER,TT.ERR)
        CALL F.READ(FN.TELLER.USER,OPERATOR,R.TEL.US,F.TELLER.USER,TEL.ERR)

*        HD1052812 -S

        CALL MULTI.GET.LOC.REF('TELLER','L.TT.WAI.CHARGE':@VM:'WAIVE.TAX',POSS)
        Y.CHG.POS = POSS<1,1>
        Y.TAX.POS = POSS<1,2>

        GOSUB PROCEED.NEXT.PARA

    END

    GOSUB FT.PROCESS.PARA

RETURN
*-----------
PROCEED.NEXT.PARA:


    IF R.TELLER THEN
*
***HD N.74 NEW TRANSACTION CODES
*
        GOSUB TELLER.TRANS.CODE
        R.NEW(TT.TE.TRANSACTION.CODE) = Y.NEW.TRANS.CODE
        R.NEW(TT.TE.TELLER.ID.1) = R.TEL.US
        R.NEW(TT.TE.CURRENCY.1) = R.TELLER<TT.TE.CURRENCY.1>
*HD1052812 -S
        R.NEW(TT.TE.NARRATIVE.1)= R.TELLER<TT.TE.NARRATIVE.1>
*HD1052812 -E

        R.NEW(TT.TE.ACCOUNT.1) = R.TELLER<TT.TE.ACCOUNT.2>
        R.NEW(TT.TE.ACCOUNT.2) = R.TELLER<TT.TE.ACCOUNT.1>
        R.NEW(TT.TE.AMOUNT.LOCAL.1) = R.TELLER<TT.TE.AMOUNT.LOCAL.1>
        R.NEW(TT.TE.AMOUNT.LOCAL.2) = R.TELLER<TT.TE.AMOUNT.LOCAL.2>
        R.NEW(TT.TE.CURRENCY.2) = R.TELLER<TT.TE.CURRENCY.2>
        R.NEW(TT.TE.TELLER.ID.2) = R.TEL.US
        R.NEW(TT.TE.WAIVE.CHARGES) = R.TELLER<TT.TE.WAIVE.CHARGES>
        R.NEW(TT.TE.LOCAL.REF)<1,Y.CHG.POS> = R.TELLER<TT.TE.LOCAL.REF,Y.CHG.POS>
        R.NEW(TT.TE.LOCAL.REF)<1,Y.TAX.POS> = R.TELLER<TT.TE.LOCAL.REF,Y.TAX.POS>
        R.NEW(TT.TE.CHARGE.CODE) = R.TELLER<TT.TE.CHARGE.CODE>
        R.NEW(TT.TE.CHRG.AMT.LOCAL) = R.TELLER<TT.TE.CHRG.AMT.LOCAL>
    END ELSE

        GOSUB COND.ELSE.PARAT

    END

RETURN
*------------
COND.ELSE.PARAT:

    Y.HIST.ID = FIELD(Y.HIST.ID,";",1)
    CALL F.READ(FN.TELLER,Y.HIST.ID,R.TELLER,F.TELLER,TEL.ERRR)
*
***HD N.74 NEW TRANSACTION CODES
*
    GOSUB TELLER.TRANS.CODE
    R.NEW(TT.TE.TRANSACTION.CODE) = Y.NEW.TRANS.CODE
    R.NEW(TT.TE.TELLER.ID.1) = R.TEL.US
    R.NEW(TT.TE.CURRENCY.1) = R.TELLER<TT.TE.CURRENCY.1>
    R.NEW(TT.TE.ACCOUNT.1) = R.TELLER<TT.TE.ACCOUNT.2>

*HD1052812 -S
    R.NEW(TT.TE.NARRATIVE.1)= R.TELLER<TT.TE.NARRATIVE.1>
*HD1052812 -E


    R.NEW(TT.TE.ACCOUNT.2) = R.TELLER<TT.TE.ACCOUNT.1>
    R.NEW(TT.TE.AMOUNT.LOCAL.1) = R.TELLER<TT.TE.AMOUNT.LOCAL.1>
    R.NEW(TT.TE.AMOUNT.LOCAL.2) = R.TELLER<TT.TE.AMOUNT.LOCAL.2>
    R.NEW(TT.TE.CURRENCY.2) = R.TELLER<TT.TE.CURRENCY.2>
    R.NEW(TT.TE.TELLER.ID.2) = R.TEL.US
    R.NEW(TT.TE.WAIVE.CHARGES) = R.TELLER<TT.TE.WAIVE.CHARGES>
    R.NEW(TT.TE.LOCAL.REF)<1,Y.CHG.POS> = R.TELLER<TT.TE.LOCAL.REF,Y.CHG.POS>
    R.NEW(TT.TE.LOCAL.REF)<1,Y.TAX.POS> = R.TELLER<TT.TE.LOCAL.REF,Y.TAX.POS>
    R.NEW(TT.TE.CHARGE.CODE) = R.TELLER<TT.TE.CHARGE.CODE>
    R.NEW(TT.TE.CHRG.AMT.LOCAL) = R.TELLER<TT.TE.CHRG.AMT.LOCAL>



* HD1052812 -E


* IF R.TELLER THEN
*    MATPARSE R.NEW FROM R.TELLER
*    TEMP.ACCOUNT=R.NEW(TT.TE.ACCOUNT.1)
*    R.NEW(TT.TE.ACCOUNT.1)=R.NEW(TT.TE.ACCOUNT.2)
*    R.NEW(TT.TE.ACCOUNT.2)=TEMP.ACCOUNT
*END

RETURN
*---------------
TELLER.TRANS.CODE:
*---------------
    IF R.TELLER<TT.TE.TRANSACTION.CODE> EQ '16' THEN

        Y.NEW.TRANS.CODE = '116'
    END

    IF R.TELLER<TT.TE.TRANSACTION.CODE> EQ '17' THEN

        Y.NEW.TRANS.CODE = '117'
    END
*----------------CHANGES MADE FOR FT REVERSAL VERSION DELIVERED IN HD1052812
    IF R.TELLER<TT.TE.TRANSACTION.CODE> EQ '21' THEN
        Y.NEW.TRANS.CODE  = '121'
    END


RETURN
*---------------
FT.PROCESS.PARA:

    IF APPLICATION EQ 'FUNDS.TRANSFER' AND Y.HIST.ID NE '' THEN
        CALL EB.READ.HISTORY.REC(F.FUNDS.TRANSFER.HIS,Y.HIST.ID,R.FUNDS.TRANSFER,FT.ERR)
        IF R.FUNDS.TRANSFER EQ '' THEN
            Y.HIST.ID = FIELD(Y.HIST.ID,";",1)
            CALL F.READ(FN.FUNDS.TRANSFER,Y.HIST.ID,R.FUNDS.TRANSFER,F.FUNDS.TRANSFER,FT.ERR)
        END

*        MATPARSE R.NEW FROM R.FUNDS.TRANSFER
*        TEMP.ACCOUNT=R.NEW(FT.CREDIT.ACCT.NO)
*        R.NEW(FT.CREDIT.ACCT.NO)=R.NEW(FT.DEBIT.ACCT.NO)
*        R.NEW(FT.DEBIT.ACCT.NO)=TEMP.ACCOUNT

        TEMP.CREDIT.ACCOUNT = R.FUNDS.TRANSFER<FT.CREDIT.ACCT.NO>
        TEMP.DEBIT.ACCOUNT = R.FUNDS.TRANSFER<FT.DEBIT.ACCT.NO>
        TEMP.DEBIT.CCY = R.FUNDS.TRANSFER<FT.DEBIT.CURRENCY>
        TEMP.AMOUNT = R.FUNDS.TRANSFER<FT.DEBIT.AMOUNT>
        TEMP.CREDIT.THEIR.REF = R.FUNDS.TRANSFER<FT.CREDIT.THEIR.REF>
        TEMP.CREDIT.CCY = R.FUNDS.TRANSFER<FT.CREDIT.CURRENCY>
*        R.NEW = ''

        R.NEW(TT.TE.TRANSACTION.CODE) = 'AC-1'
        R.NEW(FT.DEBIT.ACCT.NO) = TEMP.CREDIT.ACCOUNT
        R.NEW(FT.CREDIT.ACCT.NO) = TEMP.DEBIT.ACCOUNT
        R.NEW(FT.ORDERING.BANK) = 'BANK'
        R.NEW(FT.DEBIT.CURRENCY) = TEMP.CREDIT.CCY
        R.NEW(FT.DEBIT.AMOUNT) = TEMP.AMOUNT
        R.NEW(FT.CREDIT.THEIR.REF) = TEMP.CREDIT.THEIR.REF

*        R.NEW(FT.PROCESSING.DATE) = ''
*        R.NEW(FT.BEN.CUSTOMER) = ''
*        R.NEW(FT.DELIVERY.OUTREF) = ''
    END

RETURN

END
