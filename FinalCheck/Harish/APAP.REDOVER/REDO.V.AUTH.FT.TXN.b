* @ValidationCode : MjotMTI4OTIyMTQwNDpDcDEyNTI6MTY4MTMwMzA4MjY3NTo5MTYzODotMTotMTowOjA6ZmFsc2U6Ti9BOlIyMV9BTVIuMDotMTotMQ==
* @ValidationInfo : Timestamp         : 12 Apr 2023 18:08:02
* @ValidationInfo : Encoding          : Cp1252
* @ValidationInfo : User Name         : 91638
* @ValidationInfo : Nb tests success  : N/A
* @ValidationInfo : Nb tests failure  : N/A
* @ValidationInfo : Rating            : N/A
* @ValidationInfo : Coverage          : N/A
* @ValidationInfo : Strict flag       : N/A
* @ValidationInfo : Bypass GateKeeper : false
* @ValidationInfo : Compiler Version  : R21_AMR.0
* @ValidationInfo : Copyright Temenos Headquarters SA 1993-2021. All rights reserved.
$PACKAGE APAP.REDOVER
SUBROUTINE REDO.V.AUTH.FT.TXN

*-------------------------------------------------------------------------
* Company Name  : ASOCIACION POPULAR DE AHORROS Y PRESTAMOS
* Developed By  : Edwin Charles D
* Program Name  : REDO.V.AUTH.FT.TXN
*-------------------------------------------------------------------------
* Description: This routine is auth routine to process FT from REDO.FT.TT.TRANSACTION
*
*-------------------------------------------------------------------------
* Linked with   :
* In parameter  :
* out parameter : None
*------------------------------------------------------------------------
* MODIFICATION HISTORY
*------------------------------------------------------------------------
* DATE         Name              ODR / HD REF              DESCRIPTION
* 07-06-17     Edwin Charles D   R15 Ugrade                Initial creation
*Modification history
*Date                Who               Reference                  Description
*12-04-2023      conversion tool     R22 Auto code conversion     VM TO @VM
*12-04-2023      Mohanraj R          R22 Manual code conversion   No changes
*------------------------------------------------------------------------
    $INSERT I_COMMON
    $INSERT I_EQUATE
    $INSERT I_F.ACCOUNT
    $INSERT I_F.REDO.FT.TT.TRANSACTION
    $INSERT I_F.FUNDS.TRANSFER

    GOSUB INIT
    GOSUB OPEN.FILES
    GOSUB PROCESS

RETURN

INIT:
*----
    Y.VERSION.NAME = APPLICATION:PGM.VERSION
    Y.APPLICATION = APPLICATION

RETURN

OPEN.FILES:
*----------
    LREF.APP = 'FUNDS.TRANSFER'

    LREF.FIELDS = 'L.FT.CUSTOMER':@VM:'L.FT.COMPANY':@VM:'L.LOAN.COND':@VM:'L.ADV.INS.CNT':@VM:'L.INT.AMT.DUE':@VM:'L.NCF.REQUIRED':@VM:'L.INITIAL.ID':@VM:'L.NO.OF.INSTAL':@VM:'L.FT.CLIENT.COD':@VM:'BENEFIC.NAME':@VM:'L.PRINC.AMT.DUE':@VM:'FT.SN.PAYMTHD':@VM:'L.NEXT.VERSION':@VM:'L.ACTUAL.VERSIO':@VM:'L.LOAN.STATUS.1':@VM:'L.FT.LEGAL.ID'

    LREF.POS=''
    CALL MULTI.GET.LOC.REF(LREF.APP,LREF.FIELDS,LREF.POS)

    POS.L.FT.CUSTOMER       = LREF.POS<1,1>
    POS.L.FT.COMPANY        = LREF.POS<1,2>
    POS.L.LOAN.COND         = LREF.POS<1,3>
    POS.L.ADV.INS.CNT       = LREF.POS<1,4>
    POS.L.INT.AMT.DUE       = LREF.POS<1,5>
    POS.L.NCF.REQUIRED      = LREF.POS<1,6>
    POS.L.INITIAL.ID        = LREF.POS<1,7>
    POS.L.NO.OF.INSTAL      = LREF.POS<1,8>
    POS.L.FT.CLIENT.COD     = LREF.POS<1,9>
    POS.BENEFIC.NAME        = LREF.POS<1,10>
    POS.L.PRINC.AMT.DUE     = LREF.POS<1,11>
    POS.FT.SN.PAYMTHD       = LREF.POS<1,12>
    POS.L.NEXT.VERSION      = LREF.POS<1,13>
    POS.L.ACTUAL.VERSIO     = LREF.POS<1,14>
    POS.L.LOAN.STATUS.1     = LREF.POS<1,15>
    POS.L.FT.LEGAL.ID       = LREF.POS<1,16>

RETURN

PROCESS:
*-------

    IF APPLICATION EQ 'REDO.FT.TT.TRANSACTION' THEN
        OFSVERSION = ''
        R.FUNDS.TRANSFER<FT.TRANSACTION.TYPE>      = R.NEW(FT.TN.TRANSACTION.TYPE)
        R.FUNDS.TRANSFER<FT.DEBIT.ACCT.NO>         = R.NEW(FT.TN.DEBIT.ACCT.NO)
        R.FUNDS.TRANSFER<FT.DEBIT.CURRENCY>        = R.NEW(FT.TN.DEBIT.CURRENCY)
        R.FUNDS.TRANSFER<FT.DEBIT.VALUE.DATE>      = R.NEW(FT.TN.DEBIT.VALUE.DATE)
        R.FUNDS.TRANSFER<FT.DEBIT.THEIR.REF>       = R.NEW(FT.TN.DEBIT.THEIR.REF)
        R.FUNDS.TRANSFER<FT.CREDIT.ACCT.NO>        = R.NEW(FT.TN.CREDIT.ACCT.NO)
        R.FUNDS.TRANSFER<FT.CREDIT.AMOUNT>         = R.NEW(FT.TN.CREDIT.AMOUNT)
        R.FUNDS.TRANSFER<FT.CREDIT.CURRENCY>       = R.NEW(FT.TN.CREDIT.CURRENCY)
        R.FUNDS.TRANSFER<FT.CREDIT.VALUE.DATE>     = R.NEW(FT.TN.CREDIT.VALUE.DATE)
        R.FUNDS.TRANSFER<FT.LOCAL.REF,POS.L.ACTUAL.VERSIO>       = R.NEW(FT.TN.L.ACTUAL.VERSIO)
        R.FUNDS.TRANSFER<FT.LOCAL.REF,POS.L.NEXT.VERSION>        = R.NEW(FT.TN.L.NEXT.VERSION)
        R.FUNDS.TRANSFER<FT.LOCAL.REF,POS.L.LOAN.COND>           = R.NEW(FT.TN.L.LOAN.COND)
        R.FUNDS.TRANSFER<FT.LOCAL.REF,POS.L.LOAN.STATUS.1>       = R.NEW(FT.TN.L.LOAN.STATUS.1)
        R.FUNDS.TRANSFER<FT.LOCAL.REF,POS.L.INITIAL.ID>          = R.NEW(FT.TN.L.INITIAL.ID)
        R.FUNDS.TRANSFER<FT.CREDIT.THEIR.REF>                    = ID.NEW

        Y.ACTUAL.VERSION = '' ; Y.NEXT.VERSION = ''; Y.VERSION = '' ; Y.N.VERSION = ''
        Y.ACTUAL.VERSION = R.NEW(FT.TN.L.ACTUAL.VERSIO)
        Y.VERSION = FIELD(Y.ACTUAL.VERSION,',',2)
        Y.NEXT.VERSION   = R.NEW(FT.TN.L.NEXT.VERSION)
        Y.N.VERSION   = FIELD(Y.NEXT.VERSION,',',2)
        IF Y.VERSION THEN
            R.FUNDS.TRANSFER<FT.LOCAL.REF,POS.L.ACTUAL.VERSIO> = "FUNDS.TRANSFER,":Y.VERSION
        END
        IF Y.N.VERSION THEN
            R.FUNDS.TRANSFER<FT.LOCAL.REF,POS.L.NEXT.VERSION>  = "FUNDS.TRANSFER,":Y.N.VERSION
        END

        BEGIN CASE
            CASE Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.OTI' OR Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.PART.OTI'

                R.FUNDS.TRANSFER<FT.PROCESSING.DATE>    = R.NEW(FT.TN.PROCESSING.DATE)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.CUSTOMER>        = R.NEW(FT.TN.FT.CUSTOMER)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.COMPANY>          = R.NEW(FT.TN.FT.COMPANY)
                OFSVERSION = "FUNDS.TRANSFER,":Y.VERSION

            CASE Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.CHEQUE' OR Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.PART.CHEQUE'

                R.FUNDS.TRANSFER<FT.PROCESSING.DATE>    = R.NEW(FT.TN.PROCESSING.DATE)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.CUSTOMER>        = R.NEW(FT.TN.FT.CUSTOMER)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.LEGAL.ID>        = R.NEW(FT.TN.FT.LEGAL.ID)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.COMPANY>         = R.NEW(FT.TN.FT.COMPANY)
                OFSVERSION = "FUNDS.TRANSFER,":Y.VERSION

            CASE Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.ACDP' OR Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.PART.ACDP'

                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.CUSTOMER>        = R.NEW(FT.TN.FT.COMPANY)
                OFSVERSION = "FUNDS.TRANSFER,":Y.VERSION

            CASE Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.CASH' OR Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.PART.CASH'

                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.CUSTOMER>      = R.NEW(FT.TN.FT.CUSTOMER)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.COMPANY>       = R.NEW(FT.TN.FT.COMPANY)
                OFSVERSION = "FUNDS.TRANSFER,":Y.VERSION

            CASE Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.MULTI.AA.ACCRAP.DISB' OR Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.MULTI.AA.ACCRAP.PDISB'

                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.NCF.REQUIRED>     = R.NEW(FT.TN.NCF.REQUIRED)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.NO.OF.INSTAL>     = R.NEW(FT.TN.NO.OF.INSTAL)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.ADV.INS.CNT>      = R.NEW(FT.TN.ADV.INS.CNT)
                OFSVERSION = "FUNDS.TRANSFER,":Y.VERSION

            CASE Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.LTCC' OR Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.PART.LTCC'

                R.FUNDS.TRANSFER<FT.ORDERING.CUST>    = R.NEW(FT.TN.ORDERING.CUST)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.FT.SN.PAYMTHD>    = R.NEW(FT.TN.FT.SN.PAYMTHD)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.CLIENT.COD>    = R.NEW(FT.TN.FT.CLIENT.COD)
                OFSVERSION = "FUNDS.TRANSFER,":Y.VERSION

            CASE Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.IB.ACH' OR Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.PART.IB.ACH'

                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.CUSTOMER>      = R.NEW(FT.TN.FT.CUSTOMER)
                OFSVERSION = "FUNDS.TRANSFER,":Y.VERSION

            CASE Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.MULTI.AA.ACPOAP.DISB' OR Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.MULTI.AA.PART.ACPOAP.DISB'

                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.PRINC.AMT.DUE>    = R.NEW(FT.TN.PRINC.AMT.DUE)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.INT.AMT.DUE>      = R.NEW(FT.TN.INT.AMT.DUE)
                R.FUNDS.TRANSFER<FT.ORDERING.CUST>    = R.NEW(FT.TN.ORDERING.CUST)
                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.NCF.REQUIRED>     = R.NEW(FT.TN.NCF.REQUIRED)
                OFSVERSION = "FUNDS.TRANSFER,":Y.VERSION

            CASE Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.INTERBRANCH.ACH' OR Y.VERSION.NAME EQ 'REDO.FT.TT.TRANSACTION,REDO.AA.PART.INTERBRANCH.ACH'

                R.FUNDS.TRANSFER<FT.LOCAL.REF, POS.L.FT.CUSTOMER>      = R.NEW(FT.TN.FT.CUSTOMER)
                OFSVERSION = "FUNDS.TRANSFER,":Y.VERSION

            CASE 1

        END CASE

        IF OFSVERSION THEN
            GOSUB POST.FT.TXN
        END
    END

RETURN

POST.FT.TXN:
*-----------

    APP.NAME = "FUNDS.TRANSFER"
    OFSFUNCT = 'I'
    PROCESS  = 'PROCESS'
    GTSMODE = ''
    NO.OF.AUTH = '0'
    TRANSACTION.ID = ''
    OFSRECORD = ''

    CALL OFS.BUILD.RECORD(APP.NAME,OFSFUNCT,PROCESS,OFSVERSION,GTSMODE,NO.OF.AUTH,TRANSACTION.ID,R.FUNDS.TRANSFER,OFSRECORD)
    OFS.SOURCE.ID = 'REDO.LOAN.DISB'
    OFS.MSG.ID = ''
    OPTIONS = ''
    CALL OFS.POST.MESSAGE(OFSRECORD,OFS.MSG.ID,OFS.SOURCE.ID,OPTIONS)

RETURN
END
