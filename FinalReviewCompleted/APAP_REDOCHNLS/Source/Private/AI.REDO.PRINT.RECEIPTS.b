* @ValidationCode : Mjo4ODcwNjk5MjE6Q3AxMjUyOjE2ODM1Mjg0OTQ1MTI6SVRTUzotMTotMTowOjA6ZmFsc2U6Ti9BOlIyMl9BTVIuMDotMTotMQ==
* @ValidationInfo : Timestamp         : 08 May 2023 12:18:14
* @ValidationInfo : Encoding          : Cp1252
* @ValidationInfo : User Name         : ITSS
* @ValidationInfo : Nb tests success  : N/A
* @ValidationInfo : Nb tests failure  : N/A
* @ValidationInfo : Rating            : N/A
* @ValidationInfo : Coverage          : N/A
* @ValidationInfo : Strict flag       : N/A
* @ValidationInfo : Bypass GateKeeper : false
* @ValidationInfo : Compiler Version  : R22_AMR.0
* @ValidationInfo : Copyright Temenos Headquarters SA 1993-2021. All rights reserved.
$PACKAGE APAP.REDOCHNLS
SUBROUTINE AI.REDO.PRINT.RECEIPTS(Y.APP.VER,Y.REC.ID,HEADER.FLD,DATA.FLD,FOOTER.FLD,Y.XSL)
*-----------------------------------------------------------------------------
*Company   Name     : APAP
*Developed By       : Martin Macias
*Program   Name     : AI.REDO.PRINT.RECEIPTS
*-----------------------------------------------------------------------------
*Functionality      : Printed Receipts for Internet Banking
*-----------------------------------------------------------------------------
*MODIFICATION HISTORY:
*
* 10-APR-2023     Conversion tool   R22 Auto conversion    VM to @VM, F.READ to CACHE.READ
* 10-APR-2023      Harishvikram C   Manual R22 conversion      CALL Routine format modified
*-----------------------------------------------------------------------------
    $INSERT I_COMMON
    $INSERT I_ENQUIRY.COMMON
    $INSERT I_EQUATE
    $INSERT I_F.STANDING.ORDER
    $INSERT I_F.ACCOUNT
    $INSERT I_F.BENEFICIARY
    $INSERT I_F.CUSTOMER
    $INSERT I_F.EB.SECURE.MESSAGE
    $INSERT I_F.FT.COMMISSION.TYPE
    $INSERT I_F.FUNDS.TRANSFER
    $INSERT I_System
    $INSERT I_F.AA.ACCOUNT.DETAILS

    $INSERT I_F.REDO.ACH.PARTICIPANTS
    $INSERT I_F.REDO.APAP.STO.DUPLICATE
    $INSERT I_F.REDO.NCF.ISSUED
    $INSERT I_F.REDO.H.MOD.CHEQUERA
    $INSERT I_F.REDO.H.SOLICITUD.CK
    $INSERT I_F.REDO.H.SUCURSAL
    $INSERT I_F.REDO.PAYMENT.STOP.ACCOUNT
    $INSERT I_F.FT.BULK.SUP.PAY
    $INSERT I_F.AI.REDO.PRINT.TXN.PARAM
    $USING APAP.TAM

    GOSUB INITIALISE
    GOSUB OPEN.FILES
    GOSUB PROCESS

RETURN

*---------------
INITIALISE:
*---------------

    Y.XSL = ''
    SEP.DATA = "#@#"
    SEP.LINE = "#^#"
    TEXT.NULL = ''
    Y.COND.FT = ''
    LOC.REF.POS = ''
    F.APP = ''
    FOOTER.FLD = "^^FD7=":TEXT.NULL:"^^FD8=":TEXT.NULL:"^^FD9=":TEXT.NULL:"^^FD10=":TEXT.NULL

RETURN

*---------------
OPEN.FILES:
*---------------

    FN.ACCT = 'F.ACCOUNT'
    F.ACCT = ''
    CALL OPF(FN.ACCT,F.ACCT)

    FN.BENEF = 'F.BENEFICIARY'
    F.BENEF = ''
    CALL OPF(FN.BENEF,F.BENEF)

    FN.CUS = 'F.CUSTOMER'
    F.CUS = ''
    CALL OPF(FN.CUS,F.CUS)

    FN.BANK = 'F.REDO.ACH.PARTICIPANTS'
    F.BANK = ''
    CALL OPF(FN.BANK,F.BANK)

    FN.NCF = 'F.REDO.NCF.ISSUED'
    F.NCF = ''
    CALL OPF(FN.NCF,F.NCF)

    FN.AA.ACCOUNT.DETAILS =  'F.AA.ACCOUNT.DETAILS'
    F.AA.ACCOUNT.DETAILS  = ''
    CALL OPF(FN.AA.ACCOUNT.DETAILS,F.AA.ACCOUNT.DETAILS)

    FN.REDO.EB.USER.PRINT.VAR='F.REDO.EB.USER.PRINT.VAR'
    F.REDO.EB.USER.PRINT.VAR=''
    CALL OPF(FN.REDO.EB.USER.PRINT.VAR,F.REDO.EB.USER.PRINT.VAR)

    FN.AI.REDO.PRINT.TXN.PARAM = 'F.AI.REDO.PRINT.TXN.PARAM'
    F.AI.REDO.PRINT.TXN.PARAM  = ''
    CALL OPF(FN.AI.REDO.PRINT.TXN.PARAM,F.AI.REDO.PRINT.TXN.PARAM)

RETURN

*---------------
PROCESS:
*---------------

    BEGIN CASE
        CASE Y.APP.VER EQ "EB.SECURE.MESSAGE,AI.REDO.CLAIM.NEW.CONFIRM"
*CALL APAP.REDOCHNLS.AI.REDO.PRINT.RECEIPTS.PROCESS.CLAIM(Y.APP.VER,Y.REC.ID,HEADER.FLD,DATA.FLD,FOOTER.FLD,Y.XSL) ;*Manual R22 conversion
            CALL APAP.REDOCHNLS.aiRedoPrintReceiptsProcessClaim(Y.APP.VER,Y.REC.ID,HEADER.FLD,DATA.FLD,FOOTER.FLD,Y.XSL) ;*Manual R22 conversion
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.REQ.LETTER.CONFIRM" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.REQ.LETTER.REPRINT"
            GOSUB PROCESS.LETTER
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.AA.AC.PRIN.PAY.CONFIRM" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.AA.AC.PRIN.PAY.REPRINT" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.LOAN.BEN.PAY.CONFIRM" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.LOAN.BEN.PAY.REPRINT"
            GOSUB PROCESS.APAP.LN
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.LOAN.OUT.CONFIRM" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.LOAN.OUT.REPRINT"
            GOSUB PROCESS.OTBNK.LN
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.CARD.OUT.CONFIRM" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.CARD.OUT.REPRINT"
            GOSUB PROCESS.OTBNK.CC
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.OWN.ACCT.TRANS.CONFIRM" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.OWN.ACCT.TRANS.REPRINT"
            GOSUB PROCESS.OWN.ACCT
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.CR.CARD.RD.PAY.CONFIRM" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.CR.CARD.RD.PAY.REPRINT"
            GOSUB PROCESS.OWN.CC
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.BEN.CARD.BEN.PAY.CONFIRM" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.BEN.CARD.BEN.PAY.REPRINT"
            GOSUB PROCESS.APAP.CC
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.TP.PAYMENT.CONFIRM" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.TP.PAYMENT.REPRINT"
            GOSUB PROCESS.THIRDPARTY
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.PAYROLL.UPLOAD" OR  Y.APP.VER EQ "FUNDS.TRANSFER,AI.SUPPLIER.UPLOAD"
            GOSUB PROCESS.UPLOAD.FILE
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.REDO.FILE.UPLOAD.REPRINT"
            GOSUB PROCESS.UPLOAD.FILE.REPRINT
        CASE Y.APP.VER EQ "FUNDS.TRANSFER,AI.PAYROLL.UPLOAD.OVR" OR Y.APP.VER EQ "FUNDS.TRANSFER,AI.SUPPLIER.UPLOAD.OVR"
            GOSUB PROCESS.UPLOAD.FILE
        CASE FIELD(Y.APP.VER,',',1) EQ "FUNDS.TRANSFER"
            GOSUB PROCESS.GEN.FT
        CASE FIELD(Y.APP.VER,',',1) EQ "STANDING.ORDER"
            GOSUB PROCESS.GEN.STO
        CASE FIELD(Y.APP.VER,',',1) EQ "REDO.H.SOLICITUD.CK"
            GOSUB PROCESS.CK.REQ
        CASE FIELD(Y.APP.VER,',',1) EQ "REDO.PAYMENT.STOP.ACCOUNT"
            GOSUB PROCESS.STOP.PAY
        CASE Y.APP.VER EQ "REDO.APAP.STO.DUPLICATE,AI.REDO.LOAN.OT.CONFIRM" OR Y.APP.VER EQ "REDO.APAP.STO.DUPLICATE,AI.REDO.LOAN.OWN.CONFIRM" OR Y.APP.VER EQ "REDO.APAP.STO.DUPLICATE,AI.REDO.LOAN.PMT.CONFIRM"
            GOSUB PROCESS.STO.LN
        CASE Y.APP.VER EQ "REDO.APAP.STO.DUPLICATE,AI.REDO.CARD.OT.CONFIRM" OR Y.APP.VER EQ "REDO.APAP.STO.DUPLICATE,AI.REDO.CARD.PMT.CONFIRM" OR Y.APP.VER EQ "REDO.APAP.STO.DUPLICATE,AI.REDO.CARD.BEN.PMT.CONFIRM"
            GOSUB PROCESS.STO.CC
        CASE Y.APP.VER EQ "REDO.APAP.STO.DUPLICATE,AI.REDO.PYMT.TP.CONFIRM"
            GOSUB PROCESS.STO.TP
        CASE Y.APP.VER EQ "FT.BULK.SUP.PAY,AI.REDO.MULTI.SUP.CONFIRM"
            GOSUB PROCESS.MULTI.PY
    END CASE

    GOSUB PENDING.TRANSACTION

RETURN
*-------------------
PENDING.TRANSACTION:
*-------------------

    IF Y.NAU.FLAG EQ 'Y' THEN
        Y.XSL = 'generic.pend.html.xsl'
        Y.HEADER = 'Transaccion Pendiente de Autorizacion'
        Y.SUBHEADER = 'Detalle de la Transferencia'
        HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="
        DATA.FLD = 'Referencia:':SEP.DATA:Y.REC.ID:SEP.DATA:SEP.LINE
    END
RETURN

*---------------------------
PROCESS.UPLOAD.FILE.REPRINT:
*---------------------------

    Y.XSL = 'generic.ncf.upload.html.xsl'

    GOSUB GET.APP.FT

    Y.HEADER =DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER

    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.ACH.B.ACC':@VM:'L.NCF.NUMBER':@VM:'L.TT.TAX.AMT':@VM:'L.FTST.ACH.PART':@VM:'L.COMMENTS':@VM:"L.NCF.TAX.NUM"

    GOSUB GETTING.LOCAL.REF
    POS.L.FT.ACH.B.ACC  = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER    = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT    = LOC.REF.POS<1,3>
    POS.L.FTST.ACH.PART = LOC.REF.POS<1,4>
    POS.L.COMMENTS      = LOC.REF.POS<1,5>
    POS.L.NCF.TAX.NUM   = LOC.REF.POS<1,6>
    Y.COND.FT        = R.REC<FT.LOCAL.REF><1,POS.L.FT.ACH.B.ACC>
    Y.NCF.NUMBER     = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>
    Y.TT.TAX.AMT     = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>
    Y.FTST.ACH.PART  = R.REC<FT.LOCAL.REF><1,POS.L.FTST.ACH.PART>
    Y.L.COMMENTS     = R.REC<FT.LOCAL.REF><1,POS.L.COMMENTS>
    Y.NCF.TAX.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.TAX.NUM>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

*DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE ;* line removed - auto conversion
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE


    Y.FILE.REF = FIELD(Y.L.COMMENTS,'.',3)
    Y.FILE.TYPE = Y.FILE.REF[LEN(Y.FILE.REF)-2,LEN(Y.FILE.REF)]
    Y.FILE.REF = Y.FILE.REF[1,LEN(Y.FILE.REF)-3]
    Y.USERNAME = FIELD(Y.L.COMMENTS,'.',1)
    Y.FILE.NAME = Y.USERNAME:'.':Y.FILE.REF:'.':Y.FILE.TYPE

    DATA.FLD := DESC.FILE.NAME:SEP.DATA:Y.FILE.NAME:SEP.DATA:SEP.LINE

    Y.CURR.ID = R.REC<FT.DEBIT.CURRENCY>
    GOSUB GET.CURR.DESC
    GOSUB GET.TXN.AMOUNT

    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE


*  READ UPLOAD.DESC.DATA FROM F.REDO.EB.USER.PRINT.VAR,Y.L.COMMENTS THEN ;*Tus Start
    CALL F.READ(FN.REDO.EB.USER.PRINT.VAR,Y.L.COMMENTS,UPLOAD.DESC.DATA,F.REDO.EB.USER.PRINT.VAR,UPLOAD.DESC.DATA.ERR)
    IF UPLOAD.DESC.DATA THEN  ;* Tus End
        DATA.FLD := DESC.COMMENTS:SEP.DATA:UPLOAD.DESC.DATA:SEP.DATA:SEP.LINE
    END ELSE
        DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE
    END
    Y.NCF.NUMBER = Y.NCF.TAX.NUMBER
    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04

RETURN
*--------------------
PROCESS.UPLOAD.FILE:
*--------------------

    Y.XSL = 'generic.ncf.upload.html.xsl'

    GOSUB GET.APP.FT

    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER


    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.ACH.B.ACC':@VM:'L.NCF.NUMBER':@VM:'L.TT.TAX.AMT':@VM:'L.FTST.ACH.PART':@VM:'L.COMMENTS':@VM:"L.NCF.TAX.NUM"

    GOSUB GETTING.LOCAL.REF
    POS.L.FT.ACH.B.ACC = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    POS.L.FTST.ACH.PART = LOC.REF.POS<1,4>
    POS.L.COMMENTS = LOC.REF.POS<1,5>
    POS.L.NCF.TAX.NUM   = LOC.REF.POS<1,6>

    Y.COND.FT = R.REC<FT.LOCAL.REF><1,POS.L.FT.ACH.B.ACC>
    Y.NCF.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>
    Y.TT.TAX.AMT = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>
    Y.FTST.ACH.PART = R.REC<FT.LOCAL.REF><1,POS.L.FTST.ACH.PART>
    Y.L.COMMENTS = R.REC<FT.LOCAL.REF><1,POS.L.COMMENTS>
    Y.NCF.TAX.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.TAX.NUM>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE

    Y.FILE.REF = FIELD(Y.L.COMMENTS,'.',3)
    Y.FILE.TYPE = Y.FILE.REF[LEN(Y.FILE.REF)-2,LEN(Y.FILE.REF)]
    Y.FILE.REF = Y.FILE.REF[1,LEN(Y.FILE.REF)-3]
    Y.USERNAME = FIELD(Y.L.COMMENTS,'.',1)
    Y.FILE.NAME = Y.USERNAME:'.':Y.FILE.REF:'.':Y.FILE.TYPE

    DATA.FLD := DESC.FILE.NAME:SEP.DATA:Y.FILE.NAME:SEP.DATA:SEP.LINE

    Y.CURR.ID = R.REC<FT.DEBIT.CURRENCY>
    GOSUB GET.CURR.DESC

    GOSUB GET.TXN.AMOUNT



    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE


*  READ UPLOAD.DESC.DATA FROM F.REDO.EB.USER.PRINT.VAR,Y.L.COMMENTS THEN ;*Tus Start
    CALL F.READ(FN.REDO.EB.USER.PRINT.VAR,Y.L.COMMENTS,UPLOAD.DESC.DATA,F.REDO.EB.USER.PRINT.VAR,UPLOAD.DESC.DATA.ERR)
    IF UPLOAD.DESC.DATA THEN  ;* Tus End
        DATA.FLD := DESC.COMMENTS:SEP.DATA:UPLOAD.DESC.DATA:SEP.DATA:SEP.LINE
    END ELSE
        DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE
    END

    Y.NCF.NUMBER = Y.NCF.TAX.NUMBER
    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04
RETURN

*---------------
PROCESS.GEN.FT:
*---------------

    GOSUB GET.APP.FT
    Y.XSL = 'generic.ncf.html.xsl'
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER
    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.ACH.B.ACC':@VM:'L.NCF.NUMBER':@VM:'L.TT.TAX.AMT':@VM:'L.FTST.ACH.PART':@VM

    GOSUB GETTING.LOCAL.REF
    POS.L.FT.ACH.B.ACC = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    POS.L.FTST.ACH.PART = LOC.REF.POS<1,4>
    Y.COND.FT = R.REC<FT.LOCAL.REF><1,POS.L.FT.ACH.B.ACC>
    Y.NCF.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>
    Y.TT.TAX.AMT = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>
    Y.FTST.ACH.PART = R.REC<FT.LOCAL.REF><1,POS.L.FTST.ACH.PART>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE

    IF Y.COND.FT EQ '' THEN
        DATA.FLD := DESC.CR.ACCT.NO:SEP.DATA:R.REC<FT.CREDIT.ACCT.NO>:SEP.DATA:SEP.LINE
    END ELSE
        DATA.FLD := DESC.CR.ACCT.NO:SEP.DATA:Y.COND.FT:SEP.DATA:SEP.LINE
        Y.BANK = Y.FTST.ACH.PART
        GOSUB GET.BANK.NAME
    END

    Y.CURR.ID = R.REC<FT.DEBIT.CURRENCY>
    GOSUB GET.CURR.DESC
    GOSUB GET.TXN.AMOUNT

    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04

RETURN

*---------------
PROCESS.OWN.ACCT:
*---------------

    GOSUB GET.APP.FT
    Y.XSL = 'generic.ncf.html.xsl'
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CR.ACCT.NO:SEP.DATA:R.REC<FT.CREDIT.ACCT.NO>:SEP.DATA:SEP.LINE
    Y.CURR.ID = R.REC<FT.DEBIT.CURRENCY>
    GOSUB GET.CURR.DESC

    GOSUB GET.TXN.AMOUNT

    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

    DATA.FLD := "^^FD7=":DESC.NCF:SEP.DATA:'NO APLICA':SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TAX:SEP.DATA:'0.00':SEP.DATA:SEP.LINE

RETURN

*---------------
PROCESS.OWN.CC:
*---------------

    Y.XSL = 'generic.cc.html.xsl'
    GOSUB GET.APP.FT

    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER

    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.CR.CARD.NO':@VM:'L.NCF.TAX.NUM':@VM:'L.TT.TAX.AMT':@VM:'L.FTST.ACH.PART':@VM:'L.FT.CR.ACCT.NO':@VM

    GOSUB GETTING.LOCAL.REF

    POS.L.FT.CR.CARD.NO = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    POS.L.FTST.ACH.PART = LOC.REF.POS<1,4>
    POS.L.FT.CR.ACCT.NO = LOC.REF.POS<1,5>
    Y.COND.FT = R.REC<FT.LOCAL.REF><1,POS.L.FT.CR.CARD.NO>
    Y.NCF.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>
    Y.TT.TAX.AMT = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>
    Y.FTST.ACH.PART = R.REC<FT.LOCAL.REF><1,POS.L.FTST.ACH.PART>
    Y.CR.ACCT.NO = R.REC<FT.LOCAL.REF><1,POS.L.FT.CR.ACCT.NO>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD =  DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CR.CARD:SEP.DATA:Y.COND.FT:SEP.DATA:SEP.LINE
    Y.CURR.ID = R.REC<FT.CREDIT.CURRENCY>
    GOSUB GET.CURR.DESC
    GOSUB GET.TXN.AMOUNT

    GOSUB GET.EXCH.RATE

    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04

RETURN

*---------------
PROCESS.APAP.CC:
*---------------

    Y.XSL = 'generic.cc.html.xsl'

    GOSUB GET.APP.FT

    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER

    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.CR.CARD.NO':@VM:'L.NCF.TAX.NUM':@VM:'L.TT.TAX.AMT':@VM:'L.FTST.ACH.PART':@VM:'L.FT.CR.ACCT.NO':@VM

    GOSUB GETTING.LOCAL.REF

    POS.L.FT.CR.CARD.NO = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    POS.L.FTST.ACH.PART = LOC.REF.POS<1,4>
    POS.L.FT.CR.ACCT.NO = LOC.REF.POS<1,5>
    Y.COND.FT = R.REC<FT.LOCAL.REF><1,POS.L.FT.CR.CARD.NO>
    Y.NCF.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>
    Y.TT.TAX.AMT = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>
    Y.FTST.ACH.PART = R.REC<FT.LOCAL.REF><1,POS.L.FTST.ACH.PART>
    Y.CR.ACCT.NO = R.REC<FT.LOCAL.REF><1,POS.L.FT.CR.ACCT.NO>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CR.CARD:SEP.DATA:Y.COND.FT:SEP.DATA:SEP.LINE

    Y.STO.BEN.ID       = R.REC<FT.BENEFICIARY.ID>

    IF Y.STO.BEN.ID THEN
        CALL CACHE.READ(FN.BENEF, Y.STO.BEN.ID, R.BENEF, BENEF.ERR) ;*R22 Auto conversion
        LOC.REF.APPLICATION="BENEFICIARY"
        LOC.REF.FIELDS='L.BEN.CUST.NAME':@VM
        LOC.REF.POS = ''
        GOSUB GETTING.LOCAL.REF
        POS.L.BEN.CUST.NAME = LOC.REF.POS<1,1>
        Y.L.BEN.CUST.NAME = R.BENEF<ARC.BEN.LOCAL.REF><1,POS.L.BEN.CUST.NAME>
        DATA.FLD := DESC.CR.ACCT.NAME:SEP.DATA:Y.L.BEN.CUST.NAME:SEP.DATA:SEP.LINE
    END
    Y.CURR.ID = R.REC<FT.CREDIT.CURRENCY>
    GOSUB GET.CURR.DESC

    GOSUB GET.TXN.AMOUNT

    GOSUB GET.EXCH.RATE

    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04

RETURN

*---------------
PROCESS.OTBNK.CC:
*---------------

    Y.XSL = 'generic.cc.html.xsl'
    GOSUB GET.APP.FT
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER

    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.ACH.B.ACC':@VM:'L.NCF.TAX.NUM':@VM:'L.TT.TAX.AMT':@VM:'L.FTST.ACH.PART':@VM:'L.FT.CR.CARD.NO'

    GOSUB GETTING.LOCAL.REF

    POS.L.FT.ACH.B.ACC = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    POS.L.FTST.ACH.PART = LOC.REF.POS<1,4>
    POS.L.FT.CR.ACCT.NO = LOC.REF.POS<1,5>
    Y.COND.FT = R.REC<FT.LOCAL.REF><1,POS.L.FT.ACH.B.ACC>
    Y.NCF.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>
    Y.TT.TAX.AMT = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>
    Y.FTST.ACH.PART = R.REC<FT.LOCAL.REF><1,POS.L.FTST.ACH.PART>
    Y.CR.ACCT.NO = R.REC<FT.LOCAL.REF><1,POS.L.FT.CR.ACCT.NO>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD  = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE
*  DATA.FLD := DESC.CR.CARD:SEP.DATA:Y.CR.ACCT.NO[1,4]:'-xxxx-xxxx-':Y.CR.ACCT.NO[13,4]:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CR.CARD:SEP.DATA:Y.CR.ACCT.NO:SEP.DATA:SEP.LINE

    Y.STO.BEN.ID       = R.REC<FT.BENEFICIARY.ID>
    IF Y.STO.BEN.ID THEN
        CALL CACHE.READ(FN.BENEF, Y.STO.BEN.ID, R.BENEF, BENEF.ERR) ;*R22 Auto conversion
        LOC.REF.APPLICATION="BENEFICIARY"
        LOC.REF.FIELDS='L.BEN.CUST.NAME':@VM
        LOC.REF.POS = ''
        GOSUB GETTING.LOCAL.REF
        POS.L.BEN.CUST.NAME = LOC.REF.POS<1,1>
        Y.L.BEN.CUST.NAME = R.BENEF<ARC.BEN.LOCAL.REF><1,POS.L.BEN.CUST.NAME>
        DATA.FLD := DESC.CR.ACCT.NAME:SEP.DATA:Y.L.BEN.CUST.NAME:SEP.DATA:SEP.LINE
    END

    Y.BANK = Y.FTST.ACH.PART
    GOSUB GET.BANK.NAME
    Y.CURR.ID = R.REC<FT.CREDIT.CURRENCY>
    GOSUB GET.CURR.DESC

    GOSUB GET.TXN.AMOUNT

    GOSUB GET.EXCH.RATE

    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04

RETURN

*---------------
PROCESS.APAP.LN:
*---------------

    Y.XSL = 'generic.loan.html.xsl'
    GOSUB GET.APP.FT
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER

    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.ACH.B.ACC':@VM:'L.NCF.TAX.NUM':@VM:'L.TT.TAX.AMT':@VM:'L.FTST.ACH.PART':@VM:'L.NCF.NUMBER'

    GOSUB GETTING.LOCAL.REF

    POS.L.FT.ACH.B.ACC = LOC.REF.POS<1,1>
    POS.L.NCF.TAX.NUM = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    POS.L.FTST.ACH.PART = LOC.REF.POS<1,4>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,5>
    Y.COND.FT = R.REC<FT.LOCAL.REF><1,POS.L.FT.ACH.B.ACC>
    Y.NCF.TAX.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.TAX.NUM>
    Y.TT.TAX.AMT = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>
    Y.FTST.ACH.PART = R.REC<FT.LOCAL.REF><1,POS.L.FTST.ACH.PART>
    Y.NCF.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>

    AMT.DETAILS = ''

    Y.ARR.ID = R.REC<FT.CREDIT.ACCT.NO>
    GOSUB GET.ARR.ID
    CALL AA.REDO.GET.INDV.REPAY.AMT(Y.REC.REF,Y.ARR.ID,AMT.DETAILS)

*    Y.CAPITAL.AMT = FIELD(AMT.DETAILS,"*",1) + FIELD(AMT.DETAILS,"*",5)
    Y.CAPITAL.AMT = FIELD(AMT.DETAILS,"*",1)
    Y.CAPITAL.AMT = FMT(Y.CAPITAL.AMT,"R2,#15")
    Y.INTEREST.AMT = FMT(FIELD(AMT.DETAILS,"*",2),"R2,#15")
    Y.CHARGES.AMT = FMT(FIELD(AMT.DETAILS,"*",3),"R2,#15")
    Y.PENALTIES.AMT = FMT(FIELD(AMT.DETAILS,"*",4),"R2,#15")

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CR.ACCT.NO:SEP.DATA:R.REC<FT.CREDIT.ACCT.NO>:SEP.DATA:SEP.LINE

    Y.CURR.ID = R.REC<FT.CREDIT.CURRENCY>

    GOSUB GET.CURR.DESC

    GOSUB GET.TXN.AMOUNT

    IF Y.NCF.NUMBER NE '' THEN
        DATA.FLD := DESC.CHARGE.NCF:SEP.DATA:Y.NCF.NUMBER:SEP.DATA:SEP.LINE
    END


    DATA.FLD := DESC.CAPITAL:SEP.DATA:Y.CAPITAL.AMT:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.INTEREST:SEP.DATA:Y.INTEREST.AMT:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.INSURANCE:SEP.DATA:Y.CHARGES.AMT:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.MORA:SEP.DATA:Y.PENALTIES.AMT:SEP.DATA:SEP.LINE

    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

    Y.NCF.NUMBER = Y.NCF.TAX.NUMBER
    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04

RETURN

*---------------
PROCESS.OTBNK.LN:
*---------------

    Y.XSL = 'generic.outloan.html.xsl'

    GOSUB GET.APP.FT
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER

    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.ACH.B.ACC':@VM:'L.NCF.TAX.NUM':@VM:'L.TT.TAX.AMT':@VM:'L.FTST.ACH.PART':@VM

    GOSUB GETTING.LOCAL.REF

    POS.L.FT.ACH.B.ACC = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    POS.L.FTST.ACH.PART = LOC.REF.POS<1,4>
    Y.COND.FT = R.REC<FT.LOCAL.REF><1,POS.L.FT.ACH.B.ACC>
    Y.NCF.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>
    Y.TT.TAX.AMT = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>
    Y.FTST.ACH.PART = R.REC<FT.LOCAL.REF><1,POS.L.FTST.ACH.PART>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD  = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CR.ACCT.NO:SEP.DATA:Y.COND.FT:SEP.DATA:SEP.LINE

    Y.BANK = Y.FTST.ACH.PART
    GOSUB GET.BANK.NAME

    Y.CURR.ID = R.REC<FT.CREDIT.CURRENCY>
    GOSUB GET.CURR.DESC

    GOSUB GET.TXN.AMOUNT



    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04

RETURN

*---------------
PROCESS.THIRDPARTY:
*---------------

    Y.XSL = 'generic.ncf.html.xsl'
    GOSUB GET.APP.FT
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER



    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.CMPNY.ID':@VM:'L.NCF.TAX.NUM':@VM:'L.TT.TAX.AMT':@VM:'L.TP.BILL.NUM':@VM:'L.FT.CMPNY.NAME':@VM

    GOSUB GETTING.LOCAL.REF

    POS.L.FT.CMPNY.ID = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    POS.L.TP.BILL.NUM = LOC.REF.POS<1,4>
    POS.L.FT.CMPNY.NAME = LOC.REF.POS<1,5>
    Y.FT.CMPNY.ID = R.REC<FT.LOCAL.REF><1,POS.L.FT.CMPNY.ID>
    Y.NCF.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>
    Y.TT.TAX.AMT = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>
    Y.TP.BILL.NUM = R.REC<FT.LOCAL.REF><1,POS.L.TP.BILL.NUM>
    Y.FT.CMPNY.NAME  = R.REC<FT.LOCAL.REF><1,POS.L.FT.CMPNY.NAME>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="
    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.COMPANY:SEP.DATA:Y.FT.CMPNY.NAME:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CONTRACT:SEP.DATA:Y.TP.BILL.NUM:SEP.DATA:SEP.LINE

    Y.CURR.ID = R.REC<FT.CREDIT.CURRENCY>
    GOSUB GET.CURR.DESC

    GOSUB GET.TXN.AMOUNT


    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04

RETURN

*---------------
PROCESS.LETTER:
*---------------

    Y.XSL = 'generic.ncf.html.xsl'
    GOSUB GET.APP.FT
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER



    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.NCF.NUMBER':@VM:'L.NCF.TAX.NUM':@VM:'L.TT.TAX.AMT':@VM

    GOSUB GETTING.LOCAL.REF

    POS.L.NCF.NUM = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    Y.NCF.NUM = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUM>
    Y.NCF.NUMBER = R.REC<FT.LOCAL.REF><1,POS.L.NCF.NUMBER>
    Y.TT.TAX.AMT = R.REC<FT.LOCAL.REF><1,POS.L.TT.TAX.AMT>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="
    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.REF:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.DEBIT.ACCT.NO>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.SERVICE:SEP.DATA:R.REC<FT.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE



    Y.CURR.ID = R.REC<FT.DEBIT.CURRENCY>
    GOSUB GET.CURR.DESC

    GOSUB GET.TXN.AMOUNT

    IF Y.NCF.NUM NE '' THEN
        DATA.FLD := DESC.CHARGE.NCF:SEP.DATA:Y.NCF.NUM:SEP.DATA:SEP.LINE
    END

    Y.DATE = R.REC<FT.DEBIT.VALUE.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.DATE.TIME>[7,2]:':':R.REC<FT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    NCF.TXN.ID = Y.REC.REF
    GOSUB GET.NCF.288.04

RETURN

*---------------
PROCESS.GEN.STO:
*---------------

    Y.XSL = 'generic.sto.html.xsl'
    GOSUB GET.APP.STO
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER


    LOC.REF.APPLICATION="FUNDS.TRANSFER"
    LOC.REF.FIELDS='L.FT.CR.CARD.NO':@VM:'L.NCF.TAX.NUM':@VM:'L.TT.TAX.AMT':@VM:'L.FTST.ACH.PART':@VM:'L.FT.CR.ACCT.NO'

    GOSUB GETTING.LOCAL.REF

    POS.L.FT.CR.CARD.NO = LOC.REF.POS<1,1>
    POS.L.NCF.NUMBER = LOC.REF.POS<1,2>
    POS.L.TT.TAX.AMT = LOC.REF.POS<1,3>
    POS.L.FTST.ACH.PART = LOC.REF.POS<1,4>
    POS.L.FT.CR.ACCT.NO = LOC.REF.POS<1,5>

    Y.STO.LOC.REF.POS  = R.REC<STO.FT.LOC.REF.NO>
    Y.STO.LOC.REF.DATA = R.REC<STO.FT.LOC.REF.DATA>
    Y.STO.BEN.ID       = R.REC<STO.BENEFICIARY.ID>

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

*    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.ID:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:FIELD(Y.REC.ID,'.',1):SEP.DATA:SEP.LINE

    IF Y.APP.VER EQ 'STANDING.ORDER,AI.REDO.OWN.ACCT.TRANSFER.CONFIRM' THEN
        DATA.FLD := DESC.CR.ACCT.NO:SEP.DATA:R.REC<STO.CPTY.ACCT.NO>:SEP.DATA:SEP.LINE
    END ELSE
        GOSUB PROCESS.GEN.STO.SEC
    END
    IF Y.STO.BEN.ID THEN
        CALL CACHE.READ(FN.BENEF, Y.STO.BEN.ID, R.BENEF, BENEF.ERR) ;*R22 Auto conversion
        LOC.REF.APPLICATION="BENEFICIARY"
        LOC.REF.FIELDS='L.BEN.CUST.NAME':@VM
        LOC.REF.POS = ''
        GOSUB GETTING.LOCAL.REF
        POS.L.BEN.CUST.NAME = LOC.REF.POS<1,1>
        Y.L.BEN.CUST.NAME = R.BENEF<ARC.BEN.LOCAL.REF><1,POS.L.BEN.CUST.NAME>
        DATA.FLD := DESC.CR.ACCT.NAME:SEP.DATA:Y.L.BEN.CUST.NAME:SEP.DATA:SEP.LINE
    END

    LOCATE POS.L.FTST.ACH.PART IN Y.STO.LOC.REF.POS<1,1> SETTING STO.POS THEN
        Y.BANK = Y.STO.LOC.REF.DATA<1,STO.POS>
        IF Y.BANK THEN
            GOSUB GET.BANK.NAME
        END
    END

    Y.DATE = R.REC<STO.CURRENT.FREQUENCY>[1,8]
    GOSUB FMT.DATE
    DATA.FLD := DESC.ST.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE

    Y.DATE = R.REC<STO.CURRENT.END.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.END.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE

    Y.CURR.ID = R.REC<STO.CURRENCY>
    GOSUB GET.CURR.DESC
    DATA.FLD := DESC.PROG.AMOUNT:SEP.DATA:FMT(R.REC<STO.CURRENT.AMOUNT.BAL>,"R2,#15"):SEP.DATA:SEP.LINE



    Y.DATE = TODAY
    GOSUB FMT.DATE
    DATA.FLD := DESC.PROG.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<STO.DATE.TIME>[7,2]:':':R.REC<STO.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<STO.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

RETURN
*-----------------
PROCESS.GEN.STO.SEC:
*------------------
    IF R.REC<STO.BENEFICIARY.ID> EQ '' THEN
        DATA.FLD := DESC.CR.ACCT.NO:SEP.DATA:R.REC<STO.CPTY.ACCT.NO>:SEP.DATA:SEP.LINE
    END ELSE
        DATA.FLD := DESC.CR.ACCT.NO:SEP.DATA:R.REC<STO.BENEFICIARY.ID>:SEP.DATA:SEP.LINE
    END
RETURN
*---------------
PROCESS.CK.REQ:
*---------------

    Y.XSL = 'ckrequest.html.xsl'

    FN.SUC = 'F.REDO.H.SUCURSAL'
    F.SUC = ''
    CALL OPF(FN.SUC,F.SUC)

    FN.MOD.CK = 'F.REDO.H.MOD.CHEQUERA'
    F.MOD.CK = ''
    CALL OPF(FN.MOD.CK,F.MOD.CK)

    FN.FT.COMM = 'F.FT.COMMISSION.TYPE'
    F.FT.COMM = ''
    CALL OPF(FN.FT.COMM,F.FT.COMM)

    GOSUB GET.APP.CHQ.REQ

    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER
    GOSUB ACCT.CUSTOMER.DET

    Y.MOD.CK = ''
    IF R.REC<REDO.H.SOL.MODELO.CK> NE '' THEN
        CALL F.READ(FN.MOD.CK,R.REC<REDO.H.SOL.MODELO.CK>,R.MOD.CK,F.MOD.CK,MOD.CK.ERR)
        Y.MOD.CK = R.MOD.CK<REDO.H.MOD.DESCRIPTION>
    END ELSE
        CALL CACHE.READ(FN.FT.COMM, R.REC<REDO.H.SOL.COSTO.CK>, R.FT.COMM, FT.COMM.ERR) ;*R22 Auto conversion
        Y.MOD.CK = R.FT.COMM<FT4.DESCRIPTION>
    END
    DATA.FLD := DESC.REQ.TYPE:SEP.DATA:Y.MOD.CK:SEP.DATA:SEP.LINE

    Y.CK.RANGE.END = R.REC<REDO.H.SOL.CHQ.NO.START> + R.REC<REDO.H.SOL.CANT.CK> - 1
    CK.RANGE = R.REC<REDO.H.SOL.CHQ.NO.START>:'-':Y.CK.RANGE.END
    DATA.FLD := DESC.REQ.NUMBER:SEP.DATA:CK.RANGE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.REQ.TOTAL:SEP.DATA:R.REC<REDO.H.SOL.CANT.CK>:SEP.DATA:SEP.LINE

    SUC.ID = R.REC<REDO.H.SOL.SUC.ENTREGA>
    CALL F.READ(FN.SUC,SUC.ID,R.SUC,F.SUC,SUC.ERR)
    DATA.FLD := DESC.REQ.BRANCH:SEP.DATA:R.SUC<REDO.H.SUC.DESCRIPTION>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CURRENCY:SEP.DATA:'RD$ (PESOS DOMINICANOS)':SEP.DATA:SEP.LINE
    DATA.FLD := DESC.AMOUNT:SEP.DATA:TRIM(FMT(R.REC<REDO.H.SOL.MONTO.CK>,"R2,#15")):SEP.DATA:SEP.LINE


    Y.DATE = TODAY
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<REDO.H.SOL.DATE.TIME>[7,2]:':':R.REC<REDO.H.SOL.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    DATA.FLD := "^^FD7=":'NCF Ley 288-04:':SEP.DATA:R.REC<REDO.H.SOL.NCF.TAX.NUM>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TAX:SEP.DATA:TRIM(FMT(R.REC<REDO.H.SOL.TAX.AMOUNT>,"R2,#15")):SEP.DATA:SEP.LINE

RETURN

*----------------
ACCT.CUSTOMER.DET:
*----------------
    ACCT.ID = R.REC<REDO.H.SOL.ACCOUNT>
    CALL F.READ(FN.ACCT,ACCT.ID,R.ACCT,F.ACCT,ACCT.ERR)

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.ID:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:ACCT.ID:SEP.DATA:SEP.LINE

    CALL F.READ(FN.CUS,R.ACCT<AC.CUSTOMER>,R.CUS,F.CUS,CUS.ERR)
    DATA.FLD := DESC.DR.ACCT.NAME:SEP.DATA:TRIM(R.CUS<EB.CUS.GIVEN.NAMES>):' ':TRIM(R.CUS<EB.CUS.FAMILY.NAME>):SEP.DATA:SEP.LINE
    DATA.FLD := DESC.SERVICE:SEP.DATA:'Solicitud de Chequera':SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CHARGE.NCF:SEP.DATA:R.REC<REDO.H.SOL.NCF.NUMBER>:SEP.DATA:SEP.LINE

RETURN

*---------------
PROCESS.STOP.PAY:
*---------------

    Y.XSL = 'paymentstop.html.xsl'
    GOSUB GET.APP.CHQ.STOP
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="

    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.ID:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<REDO.PS.ACCT.ACCOUNT.NUMBER>:SEP.DATA:SEP.LINE

    CALL F.READ(FN.CUS,R.REC<REDO.PS.ACCT.CUSTOMER>,R.CUS,F.CUS,CUS.ERR)

    DATA.FLD := DESC.DR.ACCT.NAME:SEP.DATA:TRIM(R.CUS<EB.CUS.GIVEN.NAMES>):' ':TRIM(R.CUS<EB.CUS.FAMILY.NAME>):SEP.DATA:SEP.LINE
    DATA.FLD := DESC.SERVICE:SEP.DATA:'Suspension de cheques':SEP.DATA:SEP.LINE

    IF R.REC<REDO.PS.ACCT.NCF.NUMBER> NE '' THEN
        DATA.FLD := DESC.CHARGE.NCF:SEP.DATA:R.REC<REDO.PS.ACCT.NCF.NUMBER>:SEP.DATA:SEP.LINE
    END

    CK.RANGE = R.REC<REDO.PS.ACCT.CHEQUE.FIRST>
    IF R.REC<REDO.PS.ACCT.CHEQUE.FIRST> NE R.REC<REDO.PS.ACCT.CHEQUE.LAST> THEN
        CK.RANGE = R.REC<REDO.PS.ACCT.CHEQUE.FIRST>:'-':R.REC<REDO.PS.ACCT.CHEQUE.LAST>
    END
    DATA.FLD := DESC.STOP.NUMBER:SEP.DATA:CK.RANGE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.STOP.TOT:SEP.DATA:R.REC<REDO.PS.ACCT.NO.OF.LEAVES>:SEP.DATA:SEP.LINE
    DATA.FLD := 'Monto Pagado:':SEP.DATA:TRIM(FMT(R.REC<REDO.PS.ACCT.CHARGE.AMOUNT>,"R2,#15")):SEP.DATA:SEP.LINE

    Y.CURR.ID = R.REC<REDO.PS.ACCT.CHARGE.CURRENCY>
    GOSUB GET.CURR.DESC

    Y.DATE = TODAY
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<REDO.PS.ACCT.DATE.TIME>[7,2]:':':R.REC<REDO.PS.ACCT.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

    IF R.REC<REDO.PS.ACCT.TAX.AMOUNT> GT 0 THEN
        DATA.FLD := "^^FD7=":DESC.NCF:SEP.DATA:R.REC<REDO.PS.ACCT.NCF.TAX.NUM>:SEP.DATA:SEP.LINE
        DATA.FLD := DESC.TAX:SEP.DATA:TRIM(FMT(R.REC<REDO.PS.ACCT.TAX.AMOUNT>,"R2,#15")):SEP.DATA:SEP.LINE
    END ELSE
        DATA.FLD := "^^FD7=":DESC.NCF:SEP.DATA:'NO APLICA':SEP.DATA:SEP.LINE
        DATA.FLD := DESC.TAX:SEP.DATA:'0.00':SEP.DATA:SEP.LINE
    END
RETURN

*---------------
PROCESS.STO.LN:
*---------------

    Y.XSL = 'generic.sto.loan.html.xsl'
    GOSUB GET.APP.STO.DUP
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER

    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="
    ACC.ID = R.REC<REDO.SO.ORIGIN.ACCT.NO>
    LOAN.ACC.ID = R.REC<REDO.SO.LOAN.ACCT.NO>
*CALL APAP.TAM.REDO.CONVERT.ACCOUNT(LOAN.ACC.ID,Y.ARR.ID,ARR.ID,ERR.TEXT) ;*Manual R22 conversion
    CALL APAP.TAM.redoConvertAccount(LOAN.ACC.ID,Y.ARR.ID,ARR.ID,ERR.TEXT) ;*Manual R22 conversion
*    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.ID:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:ACC.ID:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CR.ACCT.NO:SEP.DATA:LOAN.ACC.ID:SEP.DATA:SEP.LINE
    Y.STO.BEN.ID       = R.REC<REDO.SO.BENEFICIARY.ID>
    IF Y.STO.BEN.ID THEN
        CALL CACHE.READ(FN.BENEF, Y.STO.BEN.ID, R.BENEF, BENEF.ERR) ;*R22 Auto conversion
        LOC.REF.APPLICATION="BENEFICIARY"
        LOC.REF.FIELDS='L.BEN.CUST.NAME':@VM:'L.BEN.ACH.ARCIB'
        LOC.REF.POS = ''
        GOSUB GETTING.LOCAL.REF
        POS.L.BEN.CUST.NAME = LOC.REF.POS<1,1>
        POS.L.BEN.ACH.ARCIB = LOC.REF.POS<1,2>
        Y.L.BEN.CUST.NAME = R.BENEF<ARC.BEN.LOCAL.REF><1,POS.L.BEN.CUST.NAME>
        Y.BANK = R.BENEF<ARC.BEN.LOCAL.REF><1,POS.L.BEN.ACH.ARCIB>
        IF Y.BANK THEN
            DATA.FLD := DESC.BANK.NAME:SEP.DATA:Y.BANK:SEP.DATA:SEP.LINE
        END
    END

    Y.DATE = R.REC<REDO.SO.STO.START.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.ST.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE

    IF Y.APP.VER EQ "REDO.APAP.STO.DUPLICATE,AI.REDO.LOAN.OWN.CONFIRM" THEN
        CALL F.READ(FN.AA.ACCOUNT.DETAILS,ARR.ID,R.AA.ACCOUNT.DETAILS,F.AA.ACCOUNT.DETAILS,AA.ACCOUNT.DETAILS.ERR)
        Y.DATE = R.AA.ACCOUNT.DETAILS<AA.AD.MATURITY.DATE>
        GOSUB FMT.DATE
        DATA.FLD := 'Fecha vencimiento:':SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
        Y.CURR.ID = R.REC<REDO.SO.CURRENCY>
        GOSUB GET.CURR.DESC
        Y.AMT = FMT(R.REC<REDO.SO.BILL.AMOUNT>,"R2,#15")
        DATA.FLD := DESC.PROG.AMOUNT:SEP.DATA:Y.AMT:SEP.DATA:SEP.LINE
    END ELSE
        Y.DATE = R.REC<REDO.SO.CURRENT.END.DATE>
        GOSUB FMT.DATE
        DATA.FLD := DESC.END.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
        Y.CURR.ID = R.REC<REDO.SO.CURRENCY>
        GOSUB GET.CURR.DESC
        Y.AMT = FMT(R.REC<REDO.SO.CURRENT.AMOUNT.BAL>,"R2,#15")
        DATA.FLD := DESC.PROG.AMOUNT:SEP.DATA:Y.AMT:SEP.DATA:SEP.LINE
    END


    Y.DATE = TODAY
    GOSUB FMT.DATE
    DATA.FLD := DESC.PROG.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<REDO.SO.DATE.TIME>[7,2]:':':R.REC<REDO.SO.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<REDO.SO.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

RETURN

*---------------
PROCESS.STO.CC:
*---------------

    Y.XSL = 'generic.sto.cc.html.xsl'
    GOSUB GET.APP.STO.DUP
*    Y.HEADER = 'Comprobante de Pago Programado'
*    Y.HEADER1 = 'Tarjeta de Credito APAP'
*    Y.SUBHEADER = 'Detalle del Pago'
    Y.HEADER    = DESC.HEADER
    Y.HEADER1   = ''
    Y.SUBHEADER = DESC.SUBHEADER



    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD4=":Y.HEADER1:"^^FD3=":Y.SUBHEADER:"^^FD6="

*    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.ID:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<REDO.SO.ORIGIN.ACCT.NO>:SEP.DATA:SEP.LINE

    Y.CARD.DISP = R.REC<REDO.SO.CARD.DISP.NO>
    IF Y.CARD.DISP THEN
        DATA.FLD := DESC.CR.CARD:SEP.DATA:Y.CARD.DISP:SEP.DATA:SEP.LINE
    END ELSE
        DATA.FLD := DESC.CR.CARD:SEP.DATA:R.REC<REDO.SO.LOAN.ACCT.NO>:SEP.DATA:SEP.LINE
    END

    Y.STO.BEN.ID       = R.REC<REDO.SO.BENEFICIARY.ID>
    IF Y.STO.BEN.ID THEN
        CALL CACHE.READ(FN.BENEF, Y.STO.BEN.ID, R.BENEF, BENEF.ERR) ;*R22 Auto conversion
        LOC.REF.APPLICATION="BENEFICIARY"
        LOC.REF.FIELDS='L.BEN.CUST.NAME':@VM:'L.BEN.ACH.ARCIB'
        LOC.REF.POS = ''
        GOSUB GETTING.LOCAL.REF
        POS.L.BEN.CUST.NAME = LOC.REF.POS<1,1>
        POS.L.BEN.ACH.ARCIB = LOC.REF.POS<1,2>
        Y.L.BEN.CUST.NAME = R.BENEF<ARC.BEN.LOCAL.REF><1,POS.L.BEN.CUST.NAME>
        Y.BANK = R.BENEF<ARC.BEN.LOCAL.REF><1,POS.L.BEN.ACH.ARCIB>
        DATA.FLD := DESC.CR.ACCT.NAME:SEP.DATA:Y.L.BEN.CUST.NAME:SEP.DATA:SEP.LINE
    END
    IF Y.BANK THEN
        DATA.FLD := DESC.BANK.NAME:SEP.DATA:Y.BANK:SEP.DATA:SEP.LINE
    END

    Y.DATE = R.REC<REDO.SO.STO.START.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.ST.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE

    Y.DATE = R.REC<REDO.SO.CURRENT.END.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.END.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    Y.CURR.ID = R.REC<REDO.SO.CURRENCY>
    GOSUB GET.CURR.DESC
    Y.AMT = FMT(R.REC<REDO.SO.CURRENT.AMOUNT.BAL>,"R2,#15")
    DATA.FLD := DESC.PROG.AMOUNT:SEP.DATA:Y.AMT:SEP.DATA:SEP.LINE



    Y.DATE = TODAY
    GOSUB FMT.DATE
    DATA.FLD := DESC.PROG.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<REDO.SO.DATE.TIME>[7,2]:':':R.REC<REDO.SO.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<REDO.SO.PAYMENT.DETAILS>:SEP.DATA:SEP.LINE

RETURN

*---------------
PROCESS.STO.TP:
*---------------

    Y.XSL = 'generic.sto.tp.html.xsl'

    GOSUB GET.APP.STO.DUP
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER


    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD4=":Y.HEADER1:"^^FD3=":Y.SUBHEADER:"^^FD6="

*    DATA.FLD = DESC.SUBHEADER:SEP.DATA:Y.REC.ID:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<REDO.SO.ORIGIN.ACCT.NO>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.COMPANY:SEP.DATA:R.REC<REDO.SO.COMPANY.NAME>:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.CONTRACT:SEP.DATA:R.REC<REDO.SO.CONTRACT.NO>:SEP.DATA:SEP.LINE


    Y.DATE = R.REC<REDO.SO.STO.START.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.ST.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE

    Y.DATE = R.REC<REDO.SO.CURRENT.END.DATE>
    GOSUB FMT.DATE
    DATA.FLD := DESC.END.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE

    Y.CURR.ID = R.REC<REDO.SO.CURRENCY>
    GOSUB GET.CURR.DESC

    Y.AMT = FMT(R.REC<REDO.SO.CURRENT.AMOUNT.BAL>,"R2,#15")
    DATA.FLD := DESC.PROG.AMOUNT:SEP.DATA:Y.AMT:SEP.DATA:SEP.LINE

    Y.DATE = TODAY
    GOSUB FMT.DATE
    DATA.FLD := DESC.PROG.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<REDO.SO.DATE.TIME>[7,2]:':':R.REC<REDO.SO.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

RETURN

*---------------
PROCESS.MULTI.PY:
*---------------

    Y.XSL = 'generic.html.xsl'
    GOSUB GET.APP.FT.BULK
    Y.HEADER = DESC.HEADER
    Y.SUBHEADER = DESC.SUBHEADER



    HEADER.FLD = "FD1=":Y.HEADER:"^^FD2=":Y.HEADER:"^^FD3=":Y.SUBHEADER:"^^FD6="
    DATA.FLD = DESC.TXN.REFERENCE:SEP.DATA:Y.REC.ID:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.DR.ACCT.NO:SEP.DATA:R.REC<FT.BUL76.DR.ACCOUNT>:SEP.DATA:SEP.LINE

    Y.CURR.ID = R.REC<FT.BUL76.DR.CURRENCY>
    GOSUB GET.CURR.DESC

*  FOR Y.POS = 1 TO DCOUNT(R.REC<FT.BUL76.CR.ACCOUNT>,VM)
*     DATA.FLD := 'Proveedor:':SEP.DATA:R.REC<FT.BUL76.CR.ACCOUNT,Y.POS>:SEP.DATA:SEP.LINE
*     DATA.FLD := 'Monto Pagado:':SEP.DATA:FMT(R.REC<FT.BUL76.CR.AMOUNT,Y.POS>,"R2,#15"):SEP.DATA:SEP.LINE
*     DATA.FLD := 'Factura:':SEP.DATA:R.REC<FT.BUL76.L.FT.INV.NO,Y.POS>:SEP.DATA:SEP.LINE
*     DATA.FLD := 'Comentario:':SEP.DATA:R.REC<FT.BUL76.L.FT.COMMENT,Y.POS>:SEP.DATA:SEP.LINE
*  NEXT Y.POS


    Y.POS = 0
    Y.POS.MAX = DCOUNT(R.REC<FT.BUL76.CR.ACCOUNT>,@VM)

    LOOP Y.POS += 1 WHILE Y.POS LE Y.POS.MAX DO
        DATA.FLD := DESC.SUPPLIER:SEP.DATA:R.REC<FT.BUL76.CR.ACCOUNT,Y.POS>:SEP.DATA:SEP.LINE
        DATA.FLD := DESC.AMOUNT:SEP.DATA:FMT(R.REC<FT.BUL76.CR.AMOUNT,Y.POS>,"R2,#15"):SEP.DATA:SEP.LINE
        DATA.FLD := DESC.BILL.NO:SEP.DATA:R.REC<FT.BUL76.L.FT.INV.NO,Y.POS>:SEP.DATA:SEP.LINE
        DATA.FLD := DESC.COMMENTS:SEP.DATA:R.REC<FT.BUL76.L.FT.COMMENT,Y.POS>:SEP.DATA:SEP.LINE
    REPEAT

    Y.DATE = TODAY
    GOSUB FMT.DATE
    DATA.FLD := DESC.DATE:SEP.DATA:Y.DATE:SEP.DATA:SEP.LINE
    DATA.FLD := DESC.TIME:SEP.DATA:R.REC<FT.BUL76.DATE.TIME>[7,2]:':':R.REC<FT.BUL76.DATE.TIME>[9,2]:SEP.DATA:SEP.LINE

RETURN


*---------------
FMT.DATE:
*---------------

    Y.DATE = Y.DATE[7,2]:'/':Y.DATE[5,2]:'/':Y.DATE[1,4]
RETURN

*---------------
GET.NCF.288.04:
*---------------

    IF Y.TT.TAX.AMT GT 0 THEN
        IF Y.NCF.NUMBER NE '' THEN
            DATA.FLD := "^^FD7=":DESC.NCF:SEP.DATA:Y.NCF.NUMBER:SEP.DATA:SEP.LINE
            DATA.FLD := DESC.TAX:SEP.DATA:TRIM(FMT(Y.TT.TAX.AMT,"R2,#15")):SEP.DATA:SEP.LINE
        END ELSE
            GOSUB GET.NCF.288.04.SEC
        END
    END ELSE
        DATA.FLD := "^^FD7=":DESC.NCF:SEP.DATA:'NO APLICA':SEP.DATA:SEP.LINE
        DATA.FLD := DESC.TAX:SEP.DATA:'0.00':SEP.DATA:SEP.LINE
    END

RETURN
*---------------
GET.NCF.288.04.SEC:
*---------------
    SEL.CMD = "SELECT ":FN.NCF:" WITH TXN.ID EQ ":NCF.TXN.ID
    CALL EB.READLIST(SEL.CMD,SEL.LIST,'',NO.OF.REC,Y.ERR)

    IF NO.OF.REC NE 0 THEN
        CALL F.READ(FN.NCF,SEL.LIST<1>,R.NCF,F.NCF,NCF.ERR)

        DATA.FLD := "^^FD7=":DESC.NCF:SEP.DATA:R.NCF<ST.IS.NCF>:SEP.DATA:SEP.LINE
        DATA.FLD := DESC.TAX:SEP.DATA:TRIM(FMT(Y.TT.TAX.AMT,"R2,#15")):SEP.DATA:SEP.LINE
    END
RETURN

*---------------
GET.BANK.NAME:
*---------------

    CALL F.READ(FN.BANK,Y.BANK,R.BANK,F.BANK,BANK.ERR)
    Y.BANK = R.BANK<REDO.ACH.PARTI.INSTITUTION>
    DATA.FLD := DESC.BANK.NAME:SEP.DATA:Y.BANK:SEP.DATA:SEP.LINE
RETURN

*---------------
GET.ARR.ID:
*---------------

    CALL F.READ(FN.ACCT,Y.ARR.ID,R.REC.ACC,F.ACCT,APP.ERR)
    Y.ARR.ID = R.REC.ACC<AC.ARRANGEMENT.ID>
RETURN

*---------------
GETTING.LOCAL.REF:
*---------------

    CALL MULTI.GET.LOC.REF(LOC.REF.APPLICATION,LOC.REF.FIELDS,LOC.REF.POS)
RETURN

*---------------
GET.APP.FT:
*---------------

    IF Y.REC.ID[LEN(Y.REC.ID)-1,1] NE ";" THEN
        FN.APP = 'F.FUNDS.TRANSFER'
    END ELSE
        FN.APP = 'F.FUNDS.TRANSFER$HIS'
    END

    GOSUB GET.APP.REC
    Y.REC.REF = FIELD(Y.REC.ID,";",1)
RETURN

*---------------
GET.APP.FT.BULK:
*---------------

    IF Y.REC.ID[LEN(Y.REC.ID)-1,1] NE ";" THEN
        FN.APP = 'F.FT.BULK.SUP.PAY'
    END ELSE
        FN.APP = 'F.FT.BULK.SUP.PAY$HIS'
    END

    GOSUB GET.APP.REC
    Y.REC.REF = FIELD(Y.REC.ID,";",1)
RETURN

*---------------
GET.APP.STO:
*---------------
    IF Y.REC.ID[LEN(Y.REC.ID)-1,1] NE ";" THEN
        FN.APP = 'F.STANDING.ORDER'
    END ELSE
        FN.APP = 'F.STANDING.ORDER$HIS'
    END

    GOSUB GET.APP.REC
    Y.REC.REF = FIELD(Y.REC.ID,";",1)
RETURN

*---------------
GET.APP.STO.DUP:
*---------------
    IF Y.REC.ID[LEN(Y.REC.ID)-1,1] NE ";" THEN
        FN.APP = 'F.REDO.APAP.STO.DUPLICATE'
    END ELSE
        FN.APP = 'F.REDO.APAP.STO.DUPLICATE$HIS'
    END

    GOSUB GET.APP.REC
    Y.REC.REF = FIELD(Y.REC.ID,";",1)
RETURN


*---------------
GET.APP.CHQ.REQ:
*---------------
    IF Y.REC.ID[LEN(Y.REC.ID)-1,1] NE ";" THEN
        FN.APP = 'F.REDO.H.SOLICITUD.CK'
    END ELSE
        FN.APP = 'F.REDO.H.SOLICITUD.CK$HIS'
    END

    GOSUB GET.APP.REC
    Y.REC.REF = FIELD(Y.REC.ID,";",1)
RETURN

*---------------
GET.APP.CHQ.STOP:
*---------------
    IF Y.REC.ID[LEN(Y.REC.ID)-1,1] NE ";" THEN
        FN.APP = 'F.REDO.PAYMENT.STOP.ACCOUNT'
    END ELSE
        FN.APP = 'F.REDO.PAYMENT.STOP.ACCOUNT$HIS'
    END

    GOSUB GET.APP.REC
    Y.REC.REF = FIELD(Y.REC.ID,";",1)
RETURN



*---------------
GET.APP.REC:
*---------------

    CALL OPF(FN.APP,F.APP)
    R.REC = ''
    Y.NAU.FLAG = ''
    CALL F.READ(FN.APP,Y.REC.ID,R.REC,F.APP,APP.ERR)
    IF R.REC EQ '' THEN
        Y.NAU.FLAG = 'Y'
    END

    IF FN.APP EQ 'FBNK.FUNDS.TRANSFER' OR FN.APP EQ 'FBNK.FUNDS.TRANSFER$HIS' THEN
        Y.TXN.TYPE = R.REC<FT.TRANSACTION.TYPE>
    END

    IF FN.APP EQ 'FBNK.STANDING.ORDER' OR FN.APP EQ 'FBNK.STANDING.ORDER$HIS' THEN
        Y.TXN.TYPE = R.REC<STO.PAY.METHOD>
    END

    IF FN.APP EQ 'F.REDO.APAP.STO.DUPLICATE' OR FN.APP EQ 'F.REDO.APAP.STO.DUPLICATE$HIS' THEN
        IF R.REC<REDO.SO.MANDATE.STATUS> EQ 'YES' THEN
            Y.NAU.FLAG = 'Y'
        END
        Y.TXN.TYPE = R.REC<REDO.SO.PAY.METHOD>
    END

    IF FN.APP EQ 'FBNK.REDO.H.SOLICITUD.CK' OR FN.APP EQ 'FBNK.REDO.H.SOLICITUD.CK$HIS' THEN
        Y.TXN.TYPE = 'CHQ.REQ'
    END

    IF FN.APP EQ 'F.REDO.PAYMENT.STOP.ACCOUNT' OR FN.APP EQ 'F.REDO.PAYMENT.STOP.ACCOUNT$HIS' THEN
        Y.TXN.TYPE = 'CHQ.STOP'
    END


    IF FN.APP EQ 'FBNK.FT.BULK.SUP.PAY' OR FN.APP EQ 'FBNK.FT.BULK.SUP.PAY$HIS' THEN
        Y.TXN.TYPE = 'MULTI'
    END


    GOSUB GET.DESC.DETAILS

RETURN
*----------------
GET.DESC.DETAILS:
*----------------
    IF R.REC THEN
        CALL F.READ(FN.AI.REDO.PRINT.TXN.PARAM,Y.TXN.TYPE,R.AI.REDO.PRINT.TXN.PARAM,F.AI.REDO.PRINT.TXN.PARAM,AI.PRT.ERR)
        DESC.TXN.REFERENCE = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.TXN.REFERENCE>
        DESC.HEADER        = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.HEADER>
        DESC.SUBHEADER     = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.SUBHEADER>
        DESC.CURRENCY      = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.TXN.CURRENCY>
        DESC.DR.ACCT.NO    = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.DR.ACCT.NO>
        DESC.DR.ACCT.NAME  = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.DR.ACCT.NAME>
        DESC.CR.ACCT.NO    = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CR.ACCT.NO>
        DESC.CR.ACCT.NAME  = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CR.ACCT.NAME>
        DESC.AMOUNT        = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.AMOUNT>
        DESC.DATE          = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.DATE>
        DESC.TIME          = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.TIME>
        DESC.CR.CARD       = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CR.CARD>
        DESC.COMMENTS      = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.COMMENTS>
        DESC.NCF           = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.NCF>
        DESC.TAX           = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.TAX>
        DESC.INTEREST      = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.INTEREST>
        DESC.CAPITAL       = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CAPITAL>
        DESC.INSURANCE     = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.INSURANCE>
        DESC.MORA          = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.MORA>
        DESC.ST.DATE       = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.ST.DATE>
        DESC.END.DATE      = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.END.DATE>
        DESC.PROG.DATE     = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.PROG.DATE>
        DESC.PROG.AMOUNT   = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.PROG.AMOUNT>
        DESC.CONTRACT      = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CONTRACT>
        DESC.SERVICE       = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.SERVICE>
        DESC.BANK.NAME     = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.BANK.NAME>
        DESC.PROG.HEADER   = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.PROG.HEADER>
        DESC.PROG.SUBHEADER= R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.PROG.SUBHEADER>
        DESC.COMPANY       = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.COMPANY>
        DESC.CHARGE.NCF    = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CHARGE.NCF>
        DESC.REQ.TYPE      = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CHQ.REQ.TYPE>
        DESC.REQ.NUMBER    = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CHQ.REQ.NUMBER>
        DESC.REQ.TOTAL     = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CHQ.REQ.TOTAL>
        DESC.REQ.BRANCH    = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CHQ.REQ.BRANCH>
        DESC.STOP.NUMBER   = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CHQ.STOP.NUMBER>
        DESC.STOP.TOT      = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CHQ.STOP.TOT>
        DESC.SUPPLIER      = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.SUPPLIER>
        DESC.BILL.NO       = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.BILL.NO>
        DESC.FILE.NAME     = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.FILE.NAME>
        DESC.CLAIM.REF     = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.CLAIM.REF>
        DESC.EXE.RATE      = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.EXE.RATE>
        DESC.EQU.AMT       = R.AI.REDO.PRINT.TXN.PARAM<AI.PRI.EQU.AMT>
    END

RETURN

*---------------
GET.CURR.DESC:
*---------------
    IF DESC.CURRENCY THEN
        IF Y.CURR.ID EQ 'DOP' THEN
            DATA.FLD := DESC.CURRENCY:SEP.DATA:'RD$ (PESOS DOMINICANOS)':SEP.DATA:SEP.LINE
        END ELSE
            DATA.FLD := DESC.CURRENCY:SEP.DATA:'USD (DOLARES AMERICANOS)':SEP.DATA:SEP.LINE
        END
    END ELSE
        IF Y.CURR.ID EQ 'DOP' THEN
            DATA.FLD := 'Moneda:':SEP.DATA:'RD$ (PESOS DOMINICANOS)':SEP.DATA:SEP.LINE
        END ELSE
            DATA.FLD := 'Moneda:':SEP.DATA:'USD (DOLARES AMERICANOS)':SEP.DATA:SEP.LINE
        END
    END
RETURN

*---------------
GET.TXN.AMOUNT:
*---------------


    IF R.REC<FT.CREDIT.AMOUNT> THEN
        DATA.FLD := DESC.AMOUNT:SEP.DATA:FMT(R.REC<FT.CREDIT.AMOUNT>,"R2,#15"):SEP.DATA:SEP.LINE
    END ELSE
        DATA.FLD := DESC.AMOUNT:SEP.DATA:FMT(R.REC<FT.DEBIT.AMOUNT>,"R2,#15"):SEP.DATA:SEP.LINE
    END

RETURN
*---------------
GET.EXCH.RATE:
*---------------

    IF Y.CURR.ID NE 'DOP' THEN
        DATA.FLD := DESC.EXE.RATE:SEP.DATA:FMT(R.REC<FT.TREASURY.RATE>,"R4,#15"):SEP.DATA:SEP.LINE
        DATA.FLD := DESC.EQU.AMT:SEP.DATA:FMT(R.REC<FT.LOC.AMT.DEBITED>,"R2,#15"):SEP.DATA:SEP.LINE
    END
RETURN

END
