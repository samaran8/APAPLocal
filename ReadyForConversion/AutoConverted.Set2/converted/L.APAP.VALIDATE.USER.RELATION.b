SUBROUTINE L.APAP.VALIDATE.USER.RELATION
    $INSERT I_COMMON
    $INSERT I_EQUATE
    $INSERT I_F.USER
    $INSERT I_F.CUSTOMER
    $INSERT I_F.RELATION.CUSTOMER
    $INSERT I_F.DEPT.ACCT.OFFICER
    $INSERT I_System

    CUS.EMPLOYEE = ""
    CTE.CUSTOMER = ""

*-- VALIDAMOS EN QUE VERSION SE ESTA REALIZANDO LA TRANSACCION
    IF APPLICATION EQ "TELLER" THEN
        CTE.CUSTOMER = R.NEW(19)
    END

    IF APPLICATION EQ "FUNDS.TRANSFER" THEN
        CTE.CUSTOMER = R.NEW(96)
    END

    IF APPLICATION EQ "T24.FUND.SERVICES" THEN
        CTE.CUSTOMER = R.NEW(3)
    END

*-- PARA ABRIR EL ACHIVO USER
    FN.USER = "F.USER"
    FV.USER = ""
    RS.USER = ""
    ERR.USER = ""

    CALL OPF(FN.USER, FV.USER)
    CALL CACHE.READ(FN.USER, OPERATOR, RS.USER, ERR.USER)
    DEPARTMENT.CODE = RS.USER<EB.USE.DEPARTMENT.CODE>

*-- PARA ABRIR EL ACHIVO DEPARTMENT.CODE
    FN.DEPT = "F.DEPT.ACCT.OFFICER"
    FV.DEPT = ""
    RS.DEPT = ""
    ERR.DEPT = ""

    CALL OPF(FN.DEPT, FV.DEPT)
    CALL CACHE.READ(FN.DEPT, DEPARTMENT.CODE, RS.DEPT, ERR.DEPT)

    CALL GET.LOC.REF("DEPT.ACCT.OFFICER", "DAO.IDENT", DAO.IDENT.POS)
    DAO.IDENT = EREPLACE(RS.DEPT<EB.DAO.LOCAL.REF, DAO.IDENT.POS, 1>, "-", "")

*-- PARA ABRIR EL ACHIVO CUSTOMER
    FN.CUS = "FBNK.CUSTOMER"
    FV.CUS = ""
    RS.CUS = ""
    ERR.CUS = ""
    SEL.LIST = ""
    NO.OF.REC = ""
    SEL.ERR = ""
    SEL.CMD = "SELECT " : FN.CUS : " WITH L.CU.CIDENT EQ " : DAO.IDENT

*-- PARA ABRIR EL ACHIVO RELATION.CUSTOMER
    FN.REL = "FBNK.RELATION.CUSTOMER"
    FV.REL = ""
    RS.REL = ""
    ERR.REL = ""
    CALL OPF(FN.REL, FV.REL)

*-- EJECUTAMOS LA CONSULTA A LA TABLA CUSTOMER
    CALL EB.READLIST(SEL.CMD, SEL.LIST, "", NO.OF.REC, SEL.ERR)

    LOOP

        REMOVE Y.CUS.ID FROM SEL.LIST SETTING CUS.POS

    WHILE Y.CUS.ID DO

        SEL.LIST = ""
        NO.OF.REC = ""
        SEL.ERR = ""
        SEL.CMD = "SELECT " : FN.REL : " WITH OF.CUSTOMER EQ " : CTE.CUSTOMER : " AND @ID EQ " : Y.CUS.ID

*EJECUTAMOS LA CONSULTA A LA TABLA RELATION.CUSTOMER
        CALL EB.READLIST(SEL.CMD, SEL.LIST, "", NO.OF.REC, SEL.ERR)

        LOOP

            REMOVE Y.REL.CUS.ID FROM SEL.LIST SETTING REL.CUS.POS

*-- SI LA CONSULTA A LA TABLA RELATION.CUSTOMER FILTRANDO POR EL NUMERO DE CLIENTE DEL USUARIO DE APAP
*-- Y POR NUMERO DE CLIENTE DEL RELACIONADO TRAE REGISTROS, SIGNIFICA QUE SI SON RELACIOADOS
        WHILE Y.REL.CUS.ID DO

*-- LANZAMOS EL OVERRIDE PARA QUE LA TRANSACCION PIDA AUTORIZACION
            TEXT = 'L.APAP.VALIDATE.USER.RELATION'
            CURR.NO = 1
            CALL STORE.OVERRIDE(CURR.NO)

        REPEAT

    REPEAT

END
