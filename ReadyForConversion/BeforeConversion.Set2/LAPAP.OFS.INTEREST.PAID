*-----------------------------------------------------------------------------
* <Rating>205</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE LAPAP.OFS.INTEREST.PAID(SEL.LIST.AZ)

    $INSERT T24.BP I_COMMON
    $INSERT T24.BP I_EQUATE
    $INSERT T24.BP I_F.DATES
    $INSERT T24.BP I_F.ACCOUNT
    $INSERT T24.BP I_F.AZ.ACCOUNT
    $INSERT T24.BP I_F.STMT.ACCT.CR
    $INSERT LAPAP.BP I_LAPAP.OFS.INTEREST.PAID.COMMON

*----------------
* Opening Tables
*----------------

    FN.AZ = "F.AZ.ACCOUNT"
    F.AZ = ""
    CALL OPF(FN.AZ,F.AZ)

    FN.ST = "F.STMT.ACCT.CR"
    F.ST = ""
    CALL OPF(FN.ST,F.ST)

    FN.DT = "F.DATES"
    F.DT = ""
    CALL OPF(FN.DT,F.DT)

    FN.AC = "F.ACCOUNT"
    F.AC = ""
    CALL OPF(FN.AC,F.ACC)

*----------------------------------
* Building date start point format
*----------------------------------

    LAST.WORKING.DATE = R.DATES(EB.DAT.LAST.WORKING.DAY)
*LAST.WORKING.DATE = 20191227

*----------------------------
* Searching all record in AZ
*----------------------------
    Y.AZ.ID = SEL.LIST.AZ
    CALL F.READ(FN.AZ,Y.AZ.ID,R.AZ,F.AZ,ERRZ)
    CALL GET.LOC.REF("AZ.ACCOUNT","L.TYPE.INT.PAY",POS)
    PAYMENT.TYPE = R.AZ<AZ.LOCAL.REF,POS>
    CUSTOMER = R.AZ<AZ.CUSTOMER>
    CALL OCOMO("AZ.ID/CUSTOMER: " : Y.AZ.ID : "/" : CUSTOMER)
    ID = CUSTOMER
    CALL LAPAP.CUSTOMER.ID(ID,RS)

    IF PAYMENT.TYPE EQ "Reinvested" THEN

* AZ.END = Y.AZ.ID:"-":LAST.WORKING.DATE
* AZ.INI = Y.AZ.ID:"-":TODAY
*        AZ.END = Y.AZ.ID:"-":20191226
*        AZ.INI = Y.AZ.ID:"-":20191227


* SEL.CMD.ST = "SELECT ":FN.ST:" WITH @ID GE ":AZ.END:" AND @ID LE ":AZ.INI

        SEL.CMD.ST = "SELECT ":FN.ST:" WITH @ID LIKE ":Y.AZ.ID:"... AND INT.POST.DATE GE ":LAST.WORKING.DATE: " AND INT.POST.DATE LT " :TODAY

        CALL EB.READLIST(SEL.CMD.ST,SEL.LIST.ST,'',NO.OF.RECS,SEL.ERR.ST)
        LOOP
            REMOVE ST FROM SEL.LIST.ST SETTING TEMP.POS
        WHILE ST DO
            CALL OCOMO("STMT.ACCT.CR.ID= " : ST)
            CALL F.READ(FN.ST,ST,R.ST,F.ST,ERR.ST)

            INT.POST.DATE.AZ = R.ST<IC.STMCR.INT.POST.DATE>
            TAX.FOR.CUSTOMER.AZ = R.ST<IC.STMCR.TAX.FOR.CUSTOMER>
            TOTAL.INTEREST.AZ = R.ST<IC.STMCR.TOTAL.INTEREST>
            GRAND.TOTAL.AZ = R.ST<IC.STMCR.GRAND.TOTAL>

            IF TAX.FOR.CUSTOMER.AC EQ '' THEN

                TAX.FOR.CUSTOMER.AC = 0

            END

            IF TAX.FOR.CUSTOMER.AZ EQ '' THEN

                TAX.FOR.CUSTOMER.AZ = 0

            END


            AZ.ARR = INT.POST.DATE.AZ:",":TAX.FOR.CUSTOMER.AZ:",":TOTAL.INTEREST.AZ:",":GRAND.TOTAL.AZ

            CALL F.READ(FN.AC,Y.AZ.ID,R.AC,F.AC,ERRC)
            REINV.ACC = R.AC<AC.INTEREST.LIQU.ACCT>
            CALL GET.LOC.REF("ACCOUNT","L.AC.AV.BAL",PS)
            BAL = R.AC<AC.LOCAL.REF,PS>

            CALL F.READ(FN.AC,REINV.ACC,R.AC,F.AC,ERRC)
            REINV.SFF = R.AC<AC.CAP.DATE.D2.INT,1>
            CALL GET.LOC.REF("ACCOUNT","L.AC.AV.BAL",PSREINV)
            BALREINV = R.AC<AC.LOCAL.REF,PSREINV>

            AC.END = REINV.ACC:"-":REINV.SFF
            AC.INI = REINV.ACC:"-":TODAY

            SEL.CMD.AC = "SELECT ":FN.ST:" WITH @ID GE ":AC.END:" AND @ID LE ":AC.INI

            CALL EB.READLIST(SEL.CMD.AC,SEL.LIST.AC,'',NO.OF.RECS,SEL.ERR.AC)

            LOOP
                REMOVE AC FROM SEL.LIST.AC SETTING TEMP.POS

            WHILE AC DO

                CALL F.READ(FN.ST,AC,R.STC,F.ST,ERR.STC)

                INT.POST.DATE.AC = R.STC<IC.STMCR.INT.POST.DATE>
                TAX.FOR.CUSTOMER.AC = R.STC<IC.STMCR.TAX.FOR.CUSTOMER>
                TOTAL.INTEREST.AC = R.STC<IC.STMCR.TOTAL.INTEREST>
                GRAND.TOTAL.AC = R.STC<IC.STMCR.GRAND.TOTAL>
                AC.ARR = INT.POST.DATE.AC:",":TAX.FOR.CUSTOMER.AC:",":TOTAL.INTEREST.AC:",":GRAND.TOTAL.AC

                BALANCE = BAL + BALREINV

                TOTAL = RS : "," : CUSTOMER : ",":Y.AZ.ID[1,10]:",":AC[12,8]:"," : TOTAL.INTEREST.AZ+TOTAL.INTEREST.AC : "," : PAYMENT.TYPE : ",":BALANCE:",":INT.POST.DATE.AC:",":'REINVERTIDO':",":TAX.FOR.CUSTOMER.AZ+TAX.FOR.CUSTOMER.AC:",":GRAND.TOTAL.AZ+GRAND.TOTAL.AC
                CALL OCOMO("TRAMA=" : TOTAL)
                TT<-1> = TOTAL

            REPEAT

        REPEAT

    END ELSE


*AZ.END = Y.AZ.ID:"-":LAST.WORKING.DATE
*AZ.INI = Y.AZ.ID:"-":TODAY

        CALL F.READ(FN.AC,Y.AZ.ID,R.AC,F.AC,ERRC)
        LIQU.ACC = R.AC<AC.INTEREST.LIQU.ACCT>
        CALL GET.LOC.REF("ACCOUNT","L.AC.AV.BAL",PS)
        BAL = R.AC<AC.LOCAL.REF,PS>

        CALL F.READ(FN.AZ,Y.AZ.ID,R.AZ,F.AZ,ERRZ)
        CALL GET.LOC.REF("AZ.ACCOUNT","L.TYPE.INT.PAY",POS)
        PAYMENT.TYPE = R.AZ<AZ.LOCAL.REF,POS>
        CUSTOMER = R.AZ<AZ.CUSTOMER>
        CALL OCOMO("AZ.ID/CUSTOMER: " : Y.AZ.ID : "/" : CUSTOMER)
        ID = CUSTOMER
        CALL LAPAP.CUSTOMER.ID(ID,RS)

*SEL.CMD.ST = "SELECT ":FN.ST:" WITH @ID GE ":AZ.END:" AND @ID LE ":AZ.INI

        SEL.CMD.ST = "SELECT ":FN.ST:" WITH @ID LIKE ":Y.AZ.ID:"... AND INT.POST.DATE GE ":LAST.WORKING.DATE: " AND INT.POST.DATE LT " :TODAY


        CALL EB.READLIST(SEL.CMD.ST,SEL.LIST.ST,'',NO.OF.RECS,SEL.ERR.ST)

        LOOP
            REMOVE ST FROM SEL.LIST.ST SETTING TEMP.POS
        WHILE ST DO

            CALL F.READ(FN.ST,ST,R.ST,F.ST,ERR.ST)

            INT.POST.DATE.AZ = R.ST<IC.STMCR.INT.POST.DATE>
            TAX.FOR.CUSTOMER.AZ = R.ST<IC.STMCR.TAX.FOR.CUSTOMER>
            TOTAL.INTEREST.AZ = R.ST<IC.STMCR.TOTAL.INTEREST>
            GRAND.TOTAL.AZ = R.ST<IC.STMCR.GRAND.TOTAL>


            IF TAX.FOR.CUSTOMER.AC EQ '' THEN

                TAX.FOR.CUSTOMER.AC = 0

            END

            IF TAX.FOR.CUSTOMER.AZ EQ '' THEN

                TAX.FOR.CUSTOMER.AZ = 0

            END


            NO.REINV = RS:",":CUSTOMER:",":ST[1,10]:",":ST[12,8]:",":TOTAL.INTEREST.AZ:",":PAYMENT.TYPE:",":BAL:",":INT.POST.DATE.AZ:",":LIQU.ACC:",":TAX.FOR.CUSTOMER.AZ:",":GRAND.TOTAL.AZ
            CALL OCOMO("TRAMA=" : NO.REINV)
            TT<-1> = NO.REINV

        REPEAT


    END


    M = DCOUNT(TT,@FM)
    FOR A = 1 TO M STEP 1

* CRT TT<A>

        ARR = ""
        ARR<-1> = "MISERVICION-": Y.AZ.ID         ;*A
        ARR<-1> = "IDENTIFICACION,CLIENTE,CUENTA,DIA_PAGO_INTERESES,INTERESES_PAGADOS,FORMA_PAGO_INTERESES,BALANCE,FECHA_HORA_LOG,CUENTA_RECIBE_INT,IMPUESTO_GOBIERNO,INTERESES_MENOS_IMP";
        ARR<-1> = "C,C,C,C,C,C,C,C,C,C,C,"
        ARR<-1> = TT<A>
        ARR<-1> = "PAGOS_INT_DEPOSITOS_BACTH"
        CALL OCOMO ("ARR=" : ARR)
        CALL LAPAP.BUILD.MONITOR.LOAD(ARR)

    NEXT A

END
