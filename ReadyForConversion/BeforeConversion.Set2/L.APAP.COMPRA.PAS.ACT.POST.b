*-----------------------------------------------------------------------------
* <Rating>149</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE L.APAP.COMPRA.PAS.ACT.POST
    $INSERT T24.BP I_COMMON
    $INSERT T24.BP I_EQUATE
    $INSERT T24.BP I_F.DATES

    GOSUB GET.LOARD.TABLE
    GOSUB GET.CONTANTES.VAR
    GOSUB SET.ESCRITURA.FINAL
GET.LOARD.TABLE:
****************
    FN.DATES = 'F.DATES'
    FV.DATES = ''
    CALL OPF(FN.DATES,FV.DATES)
    RETURN
GET.CONTANTES.VAR:
*******************
    GOSUB GET.FECHA.CORTE
    Y.DDMMYYYY = Y.FECHA.CORTE[7,2]:Y.FECHA.CORTE[5,2]:Y.FECHA.CORTE[1,4]
    Y.DIR.NAME = "../bnk.interface/REG.REPORTS"
    Y.FILE.NAME = "AR014" : Y.DDMMYYYY : ".TXT"
    Y.SAVE.NAME = 'F.TASA.AR014'
    Y.SAVE.DIR = '&SAVEDLISTS&'
    RETURN
GET.FECHA.CORTE:
****************
    R.FECHAS = ''; ERR.FECHAS = ''
    CALL F.READ(FN.DATES,'DO0010001',R.FECHAS,FV.DATES,ERR.FECHAS)
    Y.FECHA.CORTE = R.FECHAS<EB.DAT.LAST.WORKING.DAY>
    RETURN
SET.ESCRITURA.FINAL:
**********************
    Y.SECUENCIA = 0
    DELETESEQ Y.DIR.NAME, Y.FILE.NAME ELSE NULL
    OPENSEQ Y.DIR.NAME,Y.FILE.NAME TO FV.PTR ELSE
        CREATE FV.PTR ELSE
            CRT "NO SE PUEDE ABRIR ARCHIVO: " : Y.FILE.NAME : " DEL DIRECTORIO: " : Y.DIR.NAME
            STOP
        END
    END
    EXECUTE "GET.LIST F.TASA.AR014"
    READLIST ID.LIST ELSE
        ID.LIST = ''
        STOP
    END
    LOOP
        REMOVE Y.ID.CADENA FROM ID.LIST SETTING Y.STATUS
    WHILE Y.ID.CADENA DO
        Y.SECUENCIA += 1
        CAMPO.VAL1 = FMT(Y.SECUENCIA,'L#25')
        Y.FINAL = CAMPO.VAL1 :"|":Y.ID.CADENA
        WRITESEQ Y.FINAL TO FV.PTR ELSE
            CRT "NO SE PRUEDE ESCRIBIR EL ARCHIVO: " : Y.FILE.NAME
        END
    REPEAT
    CLOSESEQ FV.PTR
    GOSUB DELETE.SAVELIST
    RETURN
DELETE.SAVELIST:
****************
    DELETESEQ Y.SAVE.DIR, Y.SAVE.NAME ELSE NULL
    RETURN
END
