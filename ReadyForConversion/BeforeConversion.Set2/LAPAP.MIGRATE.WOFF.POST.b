*-----------------------------------------------------------------------------
* <Rating>361</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE LAPAP.MIGRATE.WOFF.POST
*----------------------------------------------------------------------------------------------------
* Description           : Rutina POST que genera los archivos INFILES para el proceso de migracio WOF
* Developed On          : 19-11-2019
* Developed By          : APAP
* Development Reference : GDC-704
*----------------------------------------------------------------------------------------------------
    $INSERT T24.BP I_COMMON
    $INSERT T24.BP I_EQUATE
    $INSERT T24.BP I_BATCH.FILES
    $INSERT T24.BP I_TSA.COMMON
    $INSERT BP I_F.ST.LAPAP.INFILEPRESTAMO
    $INSERT T24.BP I_F.EB.CONTRACT.BALANCES
    $INSERT T24.BP I_F.DATES
    $INSERT T24.BP I_F.AA.BILL.DETAILS
    $INSERT T24.BP I_F.ACCOUNT
    $INSERT T24.BP I_F.AA.ARRANGEMENT.ACTIVITY
    $INSERT T24.BP I_F.AA.OVERDUE
    $INSERT T24.BP I_F.AA.INTEREST
    $INSERT T24.BP I_F.AA.TERM.AMOUNT
    $INSERT T24.BP I_F.AA.ACCOUNT.DETAILS
    $INSERT T24.BP I_F.AA.PAYMENT.SCHEDULE
    $INSERT T24.BP I_F.AA.INTEREST.ACCRUALS
    $INSERT T24.BP I_F.AA.ACCOUNT
    $INSERT T24.BP I_F.AA.CUSTOMER
    $INSERT T24.BP I_F.AA.ARRANGEMENT
    $INSERT TAM.BP I_F.REDO.H.REPORTS.PARAM


MAIN.PROCES:
    GOSUB OPEN.FILES
    GOSUB READ.REPORT.PARAM
    GOSUB GENERACION.INFILE

    RETURN


OPEN.FILES:

    FN.REDO.H.REPORTS.PARAM = "F.REDO.H.REPORTS.PARAM"
    F.REDO.H.REPORTS.PARAM  = ""
    CALL OPF(FN.REDO.H.REPORTS.PARAM,F.REDO.H.REPORTS.PARAM)

    FN.ST.LAPAP.INFILEPRESTAMO  = 'F.ST.LAPAP.INFILEPRESTAMO'
    FV.ST.LAPAP.INFILEPRESTAMO = ''
    CALL OPF(FN.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO)

    RETURN

READ.REPORT.PARAM:
    ID.REPORT = 'LAPAP.ECB.BALANCES.WOF'
    CALL F.READ(FN.REDO.H.REPORTS.PARAM,ID.REPORT,R.REDO.H.REPORTS.PARAM,F.REDO.H.REPORTS.PARAM,ERROR.REPORT.PARAM)
    IF R.REDO.H.REPORTS.PARAM THEN
        Y.FILE.NAME = R.REDO.H.REPORTS.PARAM<REDO.REP.PARAM.OUT.FILE.NAME>
        Y.FIELD.NME.ARR = R.REDO.H.REPORTS.PARAM<REDO.REP.PARAM.FIELD.NAME>
        Y.FIELD.VAL.ARR = R.REDO.H.REPORTS.PARAM<REDO.REP.PARAM.FIELD.VALUE>
        Y.DISP.TEXT.ARR = R.REDO.H.REPORTS.PARAM<REDO.REP.PARAM.DISPLAY.TEXT>
        Y.DIRECTORIO.SALIDA = R.REDO.H.REPORTS.PARAM<REDO.REP.PARAM.OUT.DIR>

        LOCATE "NOMBRE.ARCHIVO" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS THEN
            Y.NOMBRE.ARCHIVO = Y.FIELD.VAL.ARR<1,COD.POS>
            Y.NOMBRE.ARCHIVO = CHANGE(Y.NOMBRE.ARCHIVO,SM,FM)
            Y.NOMBRE.ARCHIVO = CHANGE(Y.NOMBRE.ARCHIVO,VM,FM)
        END
        LOCATE "REPORTE.UNICO.PRE" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS1 THEN
            Y.REPORTE.UNICO.PR = Y.FIELD.VAL.ARR<1,COD.POS1>
            Y.REPORTE.UNICO.PR = CHANGE(Y.REPORTE.UNICO.PR,SM,FM)
            Y.REPORTE.UNICO.PR = CHANGE(Y.REPORTE.UNICO.PR,VM,FM)
        END

        LOCATE "REPORTE.UNICO.POST" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS2 THEN
            Y.REPORTE.UNICO.POST = Y.FIELD.VAL.ARR<1,COD.POS2>
            Y.REPORTE.UNICO.POST = CHANGE(Y.REPORTE.UNICO.POST,SM,FM)
            Y.REPORTE.UNICO.POST = CHANGE(Y.REPORTE.UNICO.POST,VM,FM)
        END

        LOCATE "RUTA.INFILES" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS3 THEN
            Y.RUTA.INFILES = Y.FIELD.VAL.ARR<1,COD.POS3>
            Y.RUTA.INFILES = CHANGE(Y.RUTA.INFILES,SM,FM)
            Y.RUTA.INFILES = CHANGE(Y.RUTA.INFILES,VM,FM)
        END

        LOCATE "AA.APAP.ALTNO.WOF" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS4 THEN
            Y.AA.APAP.ALTNO.WOF = Y.FIELD.VAL.ARR<1,COD.POS4>
            Y.AA.APAP.ALTNO.WOF  = CHANGE(Y.AA.APAP.ALTNO.WOF,SM,FM)
            Y.AA.APAP.ALTNO.WOF = CHANGE(Y.AA.APAP.ALTNO.WOF,VM,FM)
        END


        LOCATE "AA.PRODUCT.WOF" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS5 THEN
            Y.AA.PRODUCT.WOF = Y.FIELD.VAL.ARR<1,COD.POS5>
            Y.AA.PRODUCT.WOF = CHANGE(Y.AA.PRODUCT.WOF,SM,FM)
            Y.AA.PRODUCT.WOF = CHANGE(Y.AA.PRODUCT.WOF,VM,FM)
        END


        LOCATE "AA.APAP.BALANCEPRESTASMOS.WOF" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS6 THEN
            Y.AA.APAP.BALANCEPRESTASMOS.WOF = Y.FIELD.VAL.ARR<1,COD.POS6>
            Y.AA.APAP.BALANCEPRESTASMOS.WOF = CHANGE(Y.AA.APAP.BALANCEPRESTASMOS.WOF,SM,FM)
            Y.AA.APAP.BALANCEPRESTASMOS.WOF = CHANGE(Y.AA.APAP.BALANCEPRESTASMOS.WOF,VM,FM)
        END

        LOCATE "AA.PRODUCTWOF.CUOTA" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS7 THEN
            Y.AA.PRODUCTWOF.CUOTA = Y.FIELD.VAL.ARR<1,COD.POS7>
            Y.AA.PRODUCTWOF.CUOTA = CHANGE(Y.AA.PRODUCTWOF.CUOTA,SM,FM)
            Y.AA.PRODUCTWOF.CUOTA = CHANGE(Y.AA.PRODUCTWOF.CUOTA,VM,FM)
        END

        LOCATE "AA.APAP.DISB.PRESTASMOS.WOF" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS8 THEN
            Y.AA.APAP.DISB.PRESTASMOS.WOF = Y.FIELD.VAL.ARR<1,COD.POS8>
            Y.AA.APAP.DISB.PRESTASMOS.WOF = CHANGE(Y.AA.APAP.DISB.PRESTASMOS.WOF,SM,FM)
            Y.AA.APAP.DISB.PRESTASMOS.WOF = CHANGE(Y.AA.APAP.DISB.PRESTASMOS.WOF,VM,FM)
        END

        LOCATE "SL.CLEAR.AA.WOF" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS9 THEN
            Y.SL.CLEAR.AA.WOF = Y.FIELD.VAL.ARR<1,COD.POS9>
            Y.SL.CLEAR.AA.WOF = CHANGE(Y.SL.CLEAR.AA.WOF,SM,FM)
            Y.SL.CLEAR.AA.WOF = CHANGE(Y.SL.CLEAR.AA.WOF,VM,FM)
        END

        LOCATE "AA.APAP.CAPTURE.BALANCE.WOF" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS10 THEN
            Y.AA.APAP.CAPTURE.BALANCE.WOF = Y.FIELD.VAL.ARR<1,COD.POS10>
            Y.AA.APAP.CAPTURE.BALANCE.WOF = CHANGE(Y.AA.APAP.CAPTURE.BALANCE.WOF,SM,FM)
            Y.AA.APAP.CAPTURE.BALANCE.WOF = CHANGE(Y.AA.APAP.CAPTURE.BALANCE.WOF,VM,FM)
        END

        LOCATE "AA.PRODUCT.WOF.MONTO" IN Y.FIELD.NME.ARR<1,1> SETTING COD.POS11 THEN
            Y.AA.PRODUCT.WOF.MONTO = Y.FIELD.VAL.ARR<1,COD.POS11>
            Y.AA.PRODUCT.WOF.MONTO = CHANGE(Y.AA.PRODUCT.WOF.MONTO,SM,FM)
            Y.AA.PRODUCT.WOF.MONTO = CHANGE(Y.AA.PRODUCT.WOF.MONTO,VM,FM)
        END



        RETURN

GENERACION.INFILE:
        SEL.CMD  = ''; NO.OF.RECS = '' SEL.ERR = ''
        FN.CHK.DIR = Y.RUTA.INFILES ; F.CHK.DIR = "" ; Y.LISTA.CONSTANTE = ''
        CALL OPF(FN.CHK.DIR,F.CHK.DIR)
        SEL.CMD = " SELECT " : FN.ST.LAPAP.INFILEPRESTAMO
        CALL EB.READLIST(SEL.CMD, Y.LISTA.CONSTANTE, '',NO.OF.RECS,SEL.ERR)

        GOSUB WRITE.REPORTE.UNICO.PRE
        GOSUB WRITE.AA.APAP.ALTNO.WOF
        GOSUB WRITE.SL.CLEAR.AA.WOF
        GOSUB WRITE.AA.PRODUCT.WOF
        GOSUB WRITE.AA.APAP.BALANCEPRESTASMOS.WOF
        GOSUB WRITE.AA.PRODUCTWOF.CUOTA
        GOSUB WRITE.AA.APAP.DISB.PRESTASMOS.WOF
        GOSUB WRITE.AA.APAP.CAPTURE.BALANCE.WOF
        GOSUB WRITE.AA.PRODUCT.WOF.MONTO

        RETURN

WRITE.REPORTE.UNICO.PRE:
        Y.ID.RECORD = '' ; Y.ARREGLO = '' ; REGISTRO.POS = '' ; ERROR.LAPAP.INFILEPRESTAMO = '' ; R.ST.LAPAP.INFILEPRESTAMO = ''
        Y.FILE.NAME = Y.REPORTE.UNICO.PR:".":TODAY:".csv" ; SEL.LIST = Y.LISTA.CONSTANTE
        Y.HEADER = "ARRANGEMENT.ID,START.DATE,CONTRATO,PRODUCT.GROUP,PRODUCT,ARR.STATUS,ESTADO.ACTUAL,TIPO.PRODUCTO,"
        Y.HEADER = Y.HEADER : "ID.CLIENTE,COMPANY,ID.ALTERNO.LEGACY,ID.ALTERNO.PLAN.Z,FECHA.ORIGINAL.APERT,FECHA.APERTURA,"
        Y.HEADER = Y.HEADER : "FECHA.VENCIMIENTO,FECHA.CASTIGO,MONTO.ORIGINAL,ESTATUS,CONDICION1,CONDICION2,OBSERVACIONES,FECHA.INICIO.ADJUDICACION,"
        Y.HEADER = Y.HEADER : "COMPAÑIA.AFILIADA,TIPO.CAMPAÑA,CODEUDOR,OFICIAL.PRINCIPAL,CODIGO.SUCURSAL,ORIGEN.DE.LOS.RECURSOS,TIPO.FACILIDAD.CREDITICIA,DIA.DE.PAGO,"
        Y.HEADER = Y.HEADER : "BILL.DATE,ACCOUNTWOF,PRINCIPALINTWOF,PRINCIPALINWOF,PENALTYINTWOF,PRADMSEGWOF,PRADMVARWOF,PRMORAWOF,CANTIDAD.CUOTA"
        Y.ARREGLO<-1> = Y.HEADER
        LOOP
            REMOVE Y.ID.RECORD FROM SEL.LIST SETTING REGISTRO.POS
        WHILE Y.ID.RECORD  DO
            CALL F.READ(FN.ST.LAPAP.INFILEPRESTAMO,Y.ID.RECORD,R.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO,ERROR.LAPAP.INFILEPRESTAMO)
            GOSUB GET.REGISTRO.INFILE.UNICO.PRE
            Y.ARREGLO<-1> = Y.FINAL
        REPEAT
        GOSUB CHECK.ARCHIVO.FILES
        WRITE Y.ARREGLO ON F.CHK.DIR, Y.FILE.NAME ON ERROR
            CALL OCOMO("Error en la escritura del archivo en el directorio":F.CHK.DIR)
        END

        RETURN

WRITE.AA.APAP.ALTNO.WOF:
        Y.ID.RECORD = ''
        Y.FILE.NAME = Y.AA.APAP.ALTNO.WOF ; Y.ARREGLO = '' ; REGISTRO.POS = '' ; ERROR.LAPAP.INFILEPRESTAMO = '' ; R.ST.LAPAP.INFILEPRESTAMO = ''
        SEL.LIST = Y.LISTA.CONSTANTE
        LOOP
            REMOVE Y.ID.RECORD FROM SEL.LIST SETTING REGISTRO.POS
        WHILE Y.ID.RECORD  DO
            CALL F.READ(FN.ST.LAPAP.INFILEPRESTAMO,Y.ID.RECORD,R.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO,ERROR.LAPAP.INFILEPRESTAMO)
            Y.ARREGLO<-1> = R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ARRANGEMENT.ID>:",":"LENDING-UPDATE-ACCOUNT,ACCOUNT,ALT.ID:1::ALT.ID:4,,"
        REPEAT
        GOSUB CHECK.ARCHIVO.FILES
        WRITE Y.ARREGLO ON F.CHK.DIR, Y.FILE.NAME ON ERROR
            CALL OCOMO("Error en la escritura del archivo en el directorio":F.CHK.DIR)
        END

        RETURN

WRITE.SL.CLEAR.AA.WOF:
        Y.ID.RECORD = ''
        Y.FILE.NAME = Y.SL.CLEAR.AA.WOF; Y.ARREGLO = '' ; REGISTRO.POS = '' ; ERROR.LAPAP.INFILEPRESTAMO = '' ; R.ST.LAPAP.INFILEPRESTAMO = ''
        SEL.LIST = Y.LISTA.CONSTANTE
        LOOP
            REMOVE Y.ID.RECORD FROM SEL.LIST SETTING REGISTRO.POS
        WHILE Y.ID.RECORD  DO
            CALL F.READ(FN.ST.LAPAP.INFILEPRESTAMO,Y.ID.RECORD,R.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO,ERROR.LAPAP.INFILEPRESTAMO)
            Y.ARREGLO<-1> = R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ARRANGEMENT.ID>:","
        REPEAT

        GOSUB CHECK.ARCHIVO.FILES
        WRITE Y.ARREGLO ON F.CHK.DIR, Y.FILE.NAME ON ERROR
            CALL OCOMO("Error en la escritura del archivo en el directorio":F.CHK.DIR)
        END
        RETURN

WRITE.AA.PRODUCT.WOF:
        Y.ID.RECORD = '' ; Y.VACIO = ''
        Y.FILE.NAME = Y.AA.PRODUCT.WOF ; Y.ARREGLO = '' ; REGISTRO.POS = '' ; ERROR.LAPAP.INFILEPRESTAMO = '' ; R.ST.LAPAP.INFILEPRESTAMO = ''
        SEL.LIST = Y.LISTA.CONSTANTE
        LOOP
            REMOVE Y.ID.RECORD FROM SEL.LIST SETTING REGISTRO.POS
        WHILE Y.ID.RECORD  DO
            CALL F.READ(FN.ST.LAPAP.INFILEPRESTAMO,Y.ID.RECORD,R.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO,ERROR.LAPAP.INFILEPRESTAMO)
            Y.FECHA.DE.APERTURA = R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.ORIGINAL.APE>
            IF Y.FECHA.DE.APERTURA EQ '' THEN
                Y.FECHA.DE.APERTURA = R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.START.DATE>
            END
            Y.FINAL = ""
            Y.FINAL =  "||NEW||LENDING-TAKEOVER-ARRANGEMENT||||":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ID.CLIENTE>:"||":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.TIPO.PRODUCTO>
            Y.FINAL = Y.FINAL : "||DOP||":Y.FECHA.DE.APERTURA:"||":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.COMPANY>:"||"
            Y.FINAL = Y.FINAL : "COMMITMENT;;LIMITES;;ACCOUNTWOF;;APAP.OVERDUE;;OFICIALES;;CUSTOMER;;REPAYMENT.SCHEDULE||"
            Y.FINAL = Y.FINAL : "MATURITY.DATE::AMOUNT;;SINGLE.LIMIT;;ALT.ID:1::ALT.ID:4::ALT.ID:5::ORIGEN.RECURSOS::L.CR.FACILITY::L.AA.AGNCY.CODE;;L.STATUS.CHG.DT::L.LOAN.COMMENT1::L.ADJ.DATE;;PRIMARY.OFFICER;;L.AA.AFF.COM::L.AA.CAMP.TY::ROLE:1::OTHER.PARTY:1;;PAYMENT.FREQ||"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.VENCIMIENTO>:"::"
            IF R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ARR.STATUS> EQ 'CURRENT' THEN
                Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.MONTO.ORIGINAL> :";;N;;"
            END ELSE
                Y.FINAL = Y.FINAL : "0;;N;;"
            END
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ID.ALTERNO.LEGACY> :"::"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ID.ALTERNO.PLAN.Z> :"::"
            Y.FINAL = Y.FINAL : "VI":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CONTRATO> : "::"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ORIGEN.DE.LOS.RECU> : "::"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.TIPO.FACILIDAD.CRE> : "::"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CODIGO.SUCURSAL> :";;"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.CASTIGO> : "::"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.OBSERVACIONES> : "::"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.INICIO.ADJUD> : ";;"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.OFICIAL.PRINCIPAL> : ";;"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.COMPANIA.AFILIADA> : "::"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.TIPO.CAMPANA> : "::"
            IF R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CODEUDOR> EQ '' THEN
                Y.FINAL = Y.FINAL :Y.VACIO:"::"
            END ELSE
                Y.FINAL = Y.FINAL : "CO-SIGNER::"
            END
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CODEUDOR> :";;"
            Y.FINAL = Y.FINAL : "e0Y e1M e0W o"

            IF LEN(R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.DIA.DE.PAGO>) EQ 2 THEN
                Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.DIA.DE.PAGO>
            END ELSE
                Y.FINAL = Y.FINAL : "0":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.DIA.DE.PAGO>

            END
            Y.FINAL = Y.FINAL : "D e0F":"||"
            Y.ARREGLO<-1> = Y.FINAL


        REPEAT
        GOSUB CHECK.ARCHIVO.FILES
        WRITE Y.ARREGLO ON F.CHK.DIR, Y.FILE.NAME ON ERROR
            CALL OCOMO("Error en la escritura del archivo en el directorio":F.CHK.DIR)
        END

        RETURN


WRITE.AA.APAP.BALANCEPRESTASMOS.WOF:

        Y.ID.RECORD = ''
        Y.FILE.NAME = Y.AA.APAP.BALANCEPRESTASMOS.WOF ; Y.ARREGLO = '' ; REGISTRO.POS = '' ; ERROR.LAPAP.INFILEPRESTAMO = '' ; R.ST.LAPAP.INFILEPRESTAMO = ''
        SEL.LIST = Y.LISTA.CONSTANTE
        LOOP
            REMOVE Y.ID.RECORD FROM SEL.LIST SETTING REGISTRO.POS
        WHILE Y.ID.RECORD  DO
            CALL F.READ(FN.ST.LAPAP.INFILEPRESTAMO,Y.ID.RECORD,R.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO,ERROR.LAPAP.INFILEPRESTAMO)

            IF  R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ARR.STATUS> EQ 'CURRENT' THEN
                Y.FINAL = ""
                Y.FINAL  =  "||" :"VI" : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CONTRATO> : "||" :"LENDING-CAPTURE.BALANCE-MANT.SALD.CUOTA" : "||||" :  R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ID.CLIENTE>
                Y.FINAL = Y.FINAL : "||" :R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.TIPO.PRODUCTO> : "||" : "DOP" : "||" : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.COMPANY> : "||" :"MANT.SALD.CUOTA||"
                Y.FINAL = Y.FINAL : "ADJUST.PROP:1::ADJ.BAL.TYPE:1:1::NEW.BAL.AMT:1:1||ACCOUNTWOF::CURACCOUNTWOF::-1||"
                Y.ARREGLO<-1> = Y.FINAL
            END
        REPEAT
        GOSUB CHECK.ARCHIVO.FILES
        WRITE Y.ARREGLO ON F.CHK.DIR, Y.FILE.NAME ON ERROR
            CALL OCOMO("Error en la escritura del archivo en el directorio":F.CHK.DIR)
        END

        RETURN

WRITE.AA.PRODUCTWOF.CUOTA:
        Y.ID.RECORD = ''
        Y.FILE.NAME = Y.AA.PRODUCTWOF.CUOTA ; Y.ARREGLO = '' ; REGISTRO.POS = '' ; ERROR.LAPAP.INFILEPRESTAMO = '' ; R.ST.LAPAP.INFILEPRESTAMO = ''
        SEL.LIST = Y.LISTA.CONSTANTE
        LOOP
            REMOVE Y.ID.RECORD FROM SEL.LIST SETTING REGISTRO.POS
        WHILE Y.ID.RECORD  DO
            CALL F.READ(FN.ST.LAPAP.INFILEPRESTAMO,Y.ID.RECORD,R.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO,ERROR.LAPAP.INFILEPRESTAMO)
            IF R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ACCOUNTWOF> EQ 0 THEN
                CONTINUE
            END
            Y.FINAL = ""
            Y.FINAL = "||VI":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CONTRATO>
            Y.FINAL = Y.FINAL : "||LENDING-CAPTURE.BILL-MANT.SALD.CUOTA||":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.APERTURA>:"||"
            Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.COMPANY> : "||MANT.SALD.CUOTA||"
            Y.FINAL = Y.FINAL : "BILL.REF:1::BILL.DATE:1:1::PAYMENT.DATE:1:1::BILL.TYPE:1:1::PAYMENT.TYPE:1:1::PAYMENT.METHOD:1:1::PROPERTY:1:1::NEW.PROP.AMT:1:1::PROPERTY:1:2::NEW.PROP.AMT:1:2::PROPERTY:1:3::NEW.PROP.AMT:1:3::PROPERTY:1:4::NEW.PROP.AMT:1:4::PROPERTY:1:5::NEW.PROP.AMT:1:5::PROPERTY:1:6::NEW.PROP.AMT:1:6::PROPERTY:1:7::NEW.PROP.AMT:1:7||"
            Y.FINAL = Y.FINAL : "NEW::":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.BILL.DATE>:"::":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.BILL.DATE>:"::"
            Y.FINAL = Y.FINAL : "PAYMENT::CONSTANTE::DUE::ACCOUNTWOF::":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ACCOUNTWOF> :"::"

            IF R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRINCIPALINTWOF> EQ 0 THEN
                Y.FINAL = Y.FINAL : "PRINCIPALINTWOF::0.00::"
            END ELSE
                Y.FINAL = Y.FINAL : "PRINCIPALINTWOF::":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRINCIPALINTWOF>:"::"
            END

            IF   R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRINCIPALINWOF> EQ 0 THEN
                Y.FINAL = Y.FINAL: "PRINCIPALINWOF::0.00::"
            END ELSE
                Y.FINAL = Y.FINAL: "PRINCIPALINWOF::":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRINCIPALINWOF>:"::"
            END

            IF R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PENALTYINTWOF> EQ 0 THEN

                Y.FINAL = Y.FINAL: "PENALTYINTWOF::0.00::"

            END ELSE
                Y.FINAL = Y.FINAL: "PENALTYINTWOF::":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PENALTYINTWOF>:"::"

            END

            IF R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRADMSEGWOF> EQ 0 THEN
                Y.FINAL = Y.FINAL: "PRADMSEGWOF::0.00::"

            END ELSE
                Y.FINAL = Y.FINAL: "PRADMSEGWOF::":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRADMSEGWOF>:"::"

            END

            IF R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRADMVARWOF> EQ 0 THEN
                Y.FINAL = Y.FINAL: "PRADMVARWOF::0.00::"
            END ELSE
                Y.FINAL = Y.FINAL: "PRADMVARWOF::":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRADMVARWOF>:"::"
            END

            IF R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRMORAWOF> EQ 0 THEN
                Y.FINAL = Y.FINAL: "PRMORAWOF":"::":"0.00"

            END ELSE
                Y.FINAL = Y.FINAL: "PRMORAWOF::":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRMORAWOF>

            END
            Y.FINAL = Y.FINAL: "||"
            Y.ARREGLO<-1> = Y.FINAL

        REPEAT

        GOSUB CHECK.ARCHIVO.FILES
        WRITE Y.ARREGLO ON F.CHK.DIR, Y.FILE.NAME ON ERROR
            CALL OCOMO("Error en la escritura del archivo en el directorio":F.CHK.DIR)
        END
        RETURN


WRITE.AA.APAP.DISB.PRESTASMOS.WOF:

        Y.ID.RECORD = ''
        Y.FILE.NAME = Y.AA.APAP.DISB.PRESTASMOS.WOF ; Y.ARREGLO = '' ; REGISTRO.POS = '' ; ERROR.LAPAP.INFILEPRESTAMO = '' ; R.ST.LAPAP.INFILEPRESTAMO = ''
        SEL.LIST = Y.LISTA.CONSTANTE
        LOOP
            REMOVE Y.ID.RECORD FROM SEL.LIST SETTING REGISTRO.POS
        WHILE Y.ID.RECORD  DO
            CALL F.READ(FN.ST.LAPAP.INFILEPRESTAMO,Y.ID.RECORD,R.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO,ERROR.LAPAP.INFILEPRESTAMO)

            IF  R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ARR.STATUS> EQ 'CURRENT' THEN
                Y.FINAL = ""
                Y.FINAL = "||":"VI":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CONTRATO>:"||LENDING-ADJUST.BALANCE-MANT.SALD.CUOTA"
                Y.FINAL = Y.FINAL : "||||":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ID.CLIENTE>:"||":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.TIPO.PRODUCTO>:"||DOP||"
                Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.COMPANY>:"||MANT.SALD.CUOTA||ADJ.BAL.AMT:2:1||"
                Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.MONTO.ORIGINAL>:"||"
                Y.ARREGLO<-1> = Y.FINAL
            END
        REPEAT

        GOSUB CHECK.ARCHIVO.FILES
        WRITE Y.ARREGLO ON F.CHK.DIR, Y.FILE.NAME ON ERROR
            CALL OCOMO("Error en la escritura del archivo en el directorio":F.CHK.DIR)
        END
        RETURN


WRITE.AA.APAP.CAPTURE.BALANCE.WOF:

        Y.ID.RECORD = ''
        Y.FILE.NAME = Y.AA.APAP.CAPTURE.BALANCE.WOF ; Y.ARREGLO = '' ; REGISTRO.POS = '' ; ERROR.LAPAP.INFILEPRESTAMO = '' ; R.ST.LAPAP.INFILEPRESTAMO = ''
        SEL.LIST = Y.LISTA.CONSTANTE
        LOOP
            REMOVE Y.ID.RECORD FROM SEL.LIST SETTING REGISTRO.POS
        WHILE Y.ID.RECORD  DO
            CALL F.READ(FN.ST.LAPAP.INFILEPRESTAMO,Y.ID.RECORD,R.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO,ERROR.LAPAP.INFILEPRESTAMO)

            IF  R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ARR.STATUS> EQ 'CURRENT' THEN
                Y.FINAL = ""
                Y.FINAL = "||":"VI":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CONTRATO>:"||":"LENDING-ADJUST.BALANCE-MANT.SALD.CUOTA"
                Y.FINAL = Y.FINAL : "||||" : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ID.CLIENTE>:"||":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.TIPO.PRODUCTO>
                Y.FINAL = Y.FINAL : "||DOP||":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.COMPANY>:"||MANT.SALD.CUOTA||ADJ.BAL.AMT:1:1||1||"
                Y.ARREGLO<-1> = Y.FINAL
            END
        REPEAT
        GOSUB CHECK.ARCHIVO.FILES
        WRITE Y.ARREGLO ON F.CHK.DIR, Y.FILE.NAME ON ERROR
            CALL OCOMO("Error en la escritura del archivo en el directorio":F.CHK.DIR)
        END

        RETURN

WRITE.AA.PRODUCT.WOF.MONTO:
        Y.ID.RECORD = ''
        Y.FILE.NAME = Y.AA.PRODUCT.WOF.MONTO ; Y.ARREGLO = '' ; REGISTRO.POS = '' ; ERROR.LAPAP.INFILEPRESTAMO = '' ; R.ST.LAPAP.INFILEPRESTAMO = ''
        SEL.LIST = Y.LISTA.CONSTANTE
        LOOP
            REMOVE Y.ID.RECORD FROM SEL.LIST SETTING REGISTRO.POS
        WHILE Y.ID.RECORD  DO
            CALL F.READ(FN.ST.LAPAP.INFILEPRESTAMO,Y.ID.RECORD,R.ST.LAPAP.INFILEPRESTAMO,FV.ST.LAPAP.INFILEPRESTAMO,ERROR.LAPAP.INFILEPRESTAMO)

            IF  R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ARR.STATUS> EQ 'EXPIRED' THEN
                Y.FINAL = ""
                Y.FINAL = "||":"VI":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CONTRATO>:"||":"LENDING-AMEND.HISTORY-COMMITMENT":"||"
                Y.FECHA = ''; Y.FECHA  = R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.ORIGINAL.APE>
                IF  R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.ORIGINAL.APE> EQ '' THEN
                    Y.FECHA = R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.START.DATE>
                END
                Y.FINAL = Y.FINAL : Y.FECHA:"||":R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.COMPANY>:"||COMMITMENT||AMOUNT::L.AA.MIN.TIME::L.AA.MAX.TIME||"
                Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.MONTO.ORIGINAL>:"::0::100||"
                Y.ARREGLO<-1> = Y.FINAL
            END
        REPEAT
        GOSUB CHECK.ARCHIVO.FILES
        WRITE Y.ARREGLO ON F.CHK.DIR, Y.FILE.NAME ON ERROR
            CALL OCOMO("Error en la escritura del archivo en el directorio":F.CHK.DIR)
        END

        RETURN

CHECK.ARCHIVO.FILES:
        R.FIL = ''; READ.FIL.ERR = ''
        CALL F.READ(FN.CHK.DIR,Y.FILE.NAME,R.FIL,F.CHK.DIR,READ.FIL.ERR)
        IF R.FIL THEN
            DELETE F.CHK.DIR,Y.FILE.NAME
        END

        RETURN

GET.REGISTRO.INFILE.UNICO.PRE:
        Y.FINAL = ""
        Y.FINAL = R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ARRANGEMENT.ID> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.START.DATE> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CONTRATO> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRODUCT.GROUP>  : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRODUCT> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ARR.STATUS> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ESTADO.ACTUAL> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.TIPO.PRODUCTO> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ID.CLIENTE> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.COMPANY> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ID.ALTERNO.LEGACY> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ID.ALTERNO.PLAN.Z> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.ORIGINAL.APE> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.APERTURA> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.VENCIMIENTO> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.CASTIGO> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.MONTO.ORIGINAL> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ESTATUS> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CONDICION1> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CONDICION2> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.OBSERVACIONES> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.FECHA.INICIO.ADJUD> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.COMPANIA.AFILIADA> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.TIPO.CAMPANA> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CODEUDOR> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.OFICIAL.PRINCIPAL> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CODIGO.SUCURSAL> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ORIGEN.DE.LOS.RECU> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.TIPO.FACILIDAD.CRE> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.DIA.DE.PAGO> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.BILL.DATE> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.ACCOUNTWOF> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRINCIPALINTWOF> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRINCIPALINWOF> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PENALTYINTWOF> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRADMSEGWOF> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRADMVARWOF> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.PRMORAWOF> : ","
        Y.FINAL = Y.FINAL : R.ST.LAPAP.INFILEPRESTAMO<ST.LAP64.CANTIDAD.CUOTA>
        RETURN
    END
