*-----------------------------------------------------------------------------
* <Rating>-40</Rating>
*-----------------------------------------------------------------------------
SUBROUTINE LAPAP.V.INP.FT.CHECK.ACC.RT

$INCLUDE T24.BP I_COMMON
$INCLUDE T24.BP I_EQUATE
$INCLUDE T24.BP I_F.ACCOUNT
$INCLUDE T24.BP I_F.USER
$INCLUDE T24.BP I_F.FUNDS.TRANSFER

GOSUB INIT
GOSUB FILEOPEN
GOSUB PROCESS
RETURN
*----
INIT:
*----
FN.ACCOUNT = 'F.ACCOUNT'
F.ACCOUNT = ''
LREF.APP = 'ACCOUNT'
LREF.FIELD = 'L.AC.STATUS1'
LREF.FIELD2 = 'L.AC.STATUS2'

RETURN
*--------
FILEOPEN:
*--------
CALL OPF(FN.ACCOUNT,F.ACCOUNT)
CALL GET.LOC.REF(LREF.APP,LREF.FIELD,LREF.POS)
CALL GET.LOC.REF(LREF.APP,LREF.FIELD2,LREF.POS2)

RETURN
*--------
PROCESS:
*--------
Y.CR.DEB.ID=R.NEW(FT.CREDIT.ACCT.NO)
GOSUB OVERRIDE.GEN

Y.CR.DEB.ID=R.NEW(FT.DEBIT.ACCT.NO)
GOSUB OVERRIDE.GEN

RETURN

*------------
OVERRIDE.GEN:
*------------
CALL F.READ(FN.ACCOUNT,Y.CR.DEB.ID,R.ACCOUNT,F.ACCOUNT,CRE.ERR)
Y.STATUS=R.ACCOUNT<AC.LOCAL.REF,LREF.POS>
Y.STATUS2=R.ACCOUNT<AC.LOCAL.REF,LREF.POS2>


IF Y.STATUS2 EQ 'DECEASED' AND R.ACCOUNT<AC.CUSTOMER> NE '' THEN
ETEXT = "CUENTA PERTENECE A FALLECIDO"
CALL STORE.END.ERROR

RETURN
END

IF Y.STATUS NE 'ACTIVE' AND Y.STATUS NE '3YINACTIVE' AND Y.STATUS NE '6MINACTIVE' AND Y.STATUS NE '' AND R.ACCOUNT<AC.CUSTOMER> NE '' THEN
VIRTUAL.TAB.ID='L.AC.STATUS1'
CALL EB.LOOKUP.LIST(VIRTUAL.TAB.ID)
Y.LOOKUP.LIST=VIRTUAL.TAB.ID<2>
Y.LOOKUP.DESC=VIRTUAL.TAB.ID<11>
CHANGE '_' TO FM IN Y.LOOKUP.LIST
CHANGE '_' TO FM IN Y.LOOKUP.DESC
LOCATE Y.STATUS IN Y.LOOKUP.LIST SETTING POS1 THEN
IF R.USER<EB.USE.LANGUAGE> EQ 1 THEN
Y.MESSAGE=Y.LOOKUP.DESC<POS1,1>
END
IF R.USER<EB.USE.LANGUAGE> EQ 2 AND Y.LOOKUP.DESC<POS1,2> NE '' THEN
Y.MESSAGE=Y.LOOKUP.DESC<POS1,2>
END ELSE
Y.MESSAGE=Y.LOOKUP.DESC<POS1,1>
END
END
TEXT="REDO.AC.CHECK.ACTIVE":FM:Y.CR.DEB.ID:VM:Y.MESSAGE
OVERRIDE.FIELD.VALUE = R.NEW(AC.OVERRIDE)
CURR.NO = DCOUNT(OVERRIDE.FIELD.VALUE,'VM') + 1
CALL STORE.OVERRIDE(CURR.NO)
END
RETURN

END
